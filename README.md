Design Doc 004 æ¶æ„ï¼ˆæœ€æ–°ç‰ˆï¼‰
---
1. æ–‡æ¡£ä¿¡æ¯
é¡¹ç›®	å†…å®¹
æ–‡æ¡£åç§°	AI+PBL Agent ç³»ç»Ÿæ¶æ„è®¾è®¡
ç‰ˆæœ¬å·	v4.1
çŠ¶æ€	Draftï¼ˆå¯å®æ–½ Â· æ¶æ„å·²æ”¶æ•›ï¼‰
åˆ›å»ºæ—¥æœŸ	2026-02-20
ä½œè€…	Jason Xie
å‘½åç¡®è®¤	004 æ¶æ„
---
2. è®¾è®¡èƒŒæ™¯ä¸ç›®æ ‡
2.1 æ•™å­¦åœºæ™¯çš„ç°å®å¤æ‚æ€§
ä¼ ç»Ÿè¯¾ç¨‹è®¾è®¡å‡è®¾æ•™å¸ˆæ€»æ˜¯ä»"è¯¾ç¨‹ç›®æ ‡"å‡ºå‘ï¼Œä¾æ¬¡è®¾è®¡ï¼š
â€¢ æ•™å­¦åœºæ™¯ â†’ é©±åŠ¨é—®é¢˜ â†’ é—®é¢˜é“¾ï¼ˆ3ä¸ªæ ¸å¿ƒé—®é¢˜ï¼‰â†’ æ´»åŠ¨è®¾è®¡ â†’ å®éªŒè®¾è®¡
ä½†çœŸå®æ•™å­¦åœºæ™¯ä¸­ï¼Œæ•™å¸ˆæ›´å¸¸ä»"å·¥å…·/æ´»åŠ¨çµæ„Ÿ"èµ·æ­¥ï¼š
"æˆ‘æƒ³ç”¨ Orange åš KNN åˆ†ç±»ï¼Œä½†ä¸çŸ¥é“æ€ä¹ˆè®¾è®¡åœºæ™¯å’Œé—®é¢˜é“¾"
2.2 æ ¸å¿ƒç›®æ ‡å‡çº§
ä» ã€Œçº¿æ€§æ¨è¿›çš„è¯¾ç¨‹ç”Ÿæˆå™¨ã€ å‡çº§ä¸º ã€Œæ”¯æŒå¤šèµ·ç‚¹ã€å¯å›æº¯ã€å¤šæ–¹æ¡ˆåä½œçš„è¯¾ç¨‹æ„å»ºç³»ç»Ÿã€
2.3 å››æ¡æ ¸å¿ƒåŸåˆ™
åŸåˆ™	è¯´æ˜
æµç¨‹å¿…é¡»å¯æ„ŸçŸ¥	ç”¨æˆ·æ¸…æ¥šçŸ¥é“å½“å‰åœ¨å“ªä¸ªç¯èŠ‚
å†³ç­–å¿…é¡»å¯è§£é‡Š	æ¯ä¸ªç³»ç»Ÿè¡Œä¸ºéƒ½æœ‰æ˜ç¡®ç†ç”±
ç”¨æˆ·å¿…é¡»éšæ—¶èƒ½ä»‹å…¥	æ”¯æŒäººå·¥å¹²é¢„å’Œä¿®æ”¹
æµç¨‹ä¾èµ–ç”±ç³»ç»Ÿç®¡ç†	ä¸ä¾èµ– Prompt åˆ¤æ–­ï¼Œç”±ç³»ç»Ÿç¡¬ç¼–ç 
---
3. æ€»ä½“æ¶æ„ï¼ˆv4.1ï¼‰
3.1 æ¶æ„å…¨æ™¯å›¾
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ç”¨æˆ·ç•Œé¢å±‚                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Explorer   â”‚  â”‚   Viewer    â”‚  â”‚        Chat         â”‚ â”‚
â”‚  â”‚  (è¯¾ç¨‹æµè§ˆ)  â”‚  â”‚  (å†…å®¹å±•ç¤º)  â”‚  â”‚    (äº¤äº’å¯¹è¯)        â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                    ä»»åŠ¡è¿›åº¦ / æ­¥éª¤æŒ‡ç¤ºå™¨ / å€™é€‰æ–¹æ¡ˆé€‰æ‹©å™¨          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      REST API / SSE å±‚                       â”‚
â”‚                    FastAPI Server                           â”‚
â”‚         Session / Task / Message / Action API               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ä»»åŠ¡ç®¡ç†å±‚ (Task Manager)                 â”‚
â”‚  â€¢ Task ç”Ÿå‘½å‘¨æœŸç®¡ç†                                         â”‚
â”‚  â€¢ Stage çŠ¶æ€è·Ÿè¸ª                                            â”‚
â”‚  â€¢ ç”¨æˆ·æ“ä½œè®°å½•                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              å†³ç­–ä¸æµç¨‹æ§åˆ¶å±‚ (Decision & Flow Control)         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚  â€¢ å†³å®šä¸‹ä¸€æ­¥ Stage                                      â”‚â”‚
â”‚  â”‚  â€¢ åˆ¤æ–­æ˜¯å¦è¡¥å…¨å‰ç½®ä¾èµ–                                   â”‚â”‚
â”‚  â”‚  â€¢ ç”Ÿæˆç”¨æˆ·è§£é‡Šä¸å¼•å¯¼                                     â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                           LLM + è§„åˆ™å¼•æ“                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Stage ç”Ÿæˆå™¨ (Stage Generator)               â”‚
â”‚  â€¢ å• Stage å†…å®¹ç”Ÿæˆ                                         â”‚
â”‚  â€¢ æ¯æ¬¡ç”Ÿæˆ 3 ä¸ªå€™é€‰æ–¹æ¡ˆ                                      â”‚
â”‚  â€¢ ä¸¥æ ¼ç»“æ„åŒ–è¾“å‡º                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            éšè—æµç¨‹å›¾å¼•æ“ (Hidden Flow Graph)                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚  âš ï¸ LangGraph / DAG - å¯¹ç”¨æˆ·ä¸å¯è§                      â”‚â”‚
â”‚  â”‚  â€¢ Stage ä¾èµ–å…³ç³»ç®¡ç†                                    â”‚â”‚
â”‚  â”‚  â€¢ å¤šæ–¹æ¡ˆåˆ†æ”¯è®°å½•                                        â”‚â”‚
â”‚  â”‚  â€¢ åå‘è¡¥å…¨ä¸çº¦æŸä¼ æ’­                                     â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  çŸ¥è¯†ä¸å·¥å…·å±‚ (Knowledge & Tool)               â”‚
â”‚  â€¢ Knowledge Templates (çŸ¥è¯†æ¨¡æ¿)                           â”‚
â”‚  â€¢ Tool Seed (æ´»åŠ¨/è½¯ä»¶/ç®—æ³•ç§å­)                            â”‚
â”‚  â€¢ Web Search (ç”¨æˆ·è§¦å‘æœç´¢)                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
3.2 å…³é”®è®¾è®¡å†³ç­–
LangGraph ä»…ä½œä¸º"æµç¨‹ä¸ä¾èµ–å¼•æ“"å­˜åœ¨ï¼Œä¸æš´éœ²ç»™ç”¨æˆ·
ç»„ä»¶	èŒè´£	ä¸åšä»€ä¹ˆ
LangGraph	æµç¨‹çº¦æŸã€ä¾èµ–è¡¥å…¨ã€åˆ†æ”¯è®°å½•	âŒ ä¸ç”Ÿæˆå†…å®¹ã€âŒ ä¸è§£é‡Šã€âŒ ä¸ç›´æ¥å¯¹è¯
LLM	å†³ç­–ã€è§£é‡Šã€å†…å®¹ç”Ÿæˆ	âŒ ä¸ç®¡ç†æµç¨‹çŠ¶æ€
ç”¨æˆ·çœ‹åˆ°	"æˆ‘ä»¬åœ¨å¹²å˜›"ã€"ä¸ºä»€ä¹ˆ"ã€"è½®åˆ°ä½ äº†"	âŒ ä¸çŸ¥é“ LangGraph å­˜åœ¨
---
4. æ ¸å¿ƒæ¦‚å¿µå®šä¹‰
4.1 Taskï¼ˆä»»åŠ¡ï¼‰
ä¸€æ¬¡å®Œæ•´è¯¾ç¨‹æ„å»º = ä¸€ä¸ª Task
{
  "task_id": "task_abc123",
  "session_id": "session_xyz789",
  "entry_point": "scenario" | "tool_seed",  // æ–°å¢ï¼šæ”¯æŒå¤šèµ·ç‚¹
  "current_stage": "driving_question",
  "completed_stages": ["scenario"],
  "status": "active" | "completed",
  "created_at": "2026-02-20T10:00:00Z",
  "updated_at": "2026-02-20T10:05:00Z"
}
4.2 Stageï¼ˆé˜¶æ®µï¼‰
â€¢ Stage ä»æ˜¯ æµç¨‹å•ä½
â€¢ ä¸å†å‡è®¾çº¿æ€§é¡ºåº - æ˜¯å¦å¯æ‰§è¡Œç”± ä¾èµ–æ˜¯å¦æ»¡è¶³ å†³å®š
â€¢ æ¯ä¸ª Stage æœ‰æ˜ç¡®çš„è¾“å…¥ä¾èµ–å’Œè¾“å‡ºäº§ç‰©
4.3 Tool Seedï¼ˆå·¥å…·ç§å­ï¼‰ã€æ–°å¢ã€‘
Tool Seed æ˜¯ä¸€ç§"åå‘å…¥å£ Stage"
ç”¨äºæè¿°æ•™å¸ˆå·²ç¡®å®šè¦ä½¿ç”¨çš„å·¥å…·/è½¯ä»¶/æ´»åŠ¨ï¼Œä½†æ•™å­¦ç»“æ„å°šæœªæˆå‹ã€‚
{
  "tool_seed": {
    "tool_name": "Orange",
    "algorithm": ["KNN", "å†³ç­–æ ‘"],
    "affordances": [
      "åˆ†ç±»å¯è§†åŒ–",
      "å‚æ•°è°ƒèŠ‚",
      "å³æ—¶åé¦ˆ"
    ],
    "constraints": {
      "grade": "åˆäºŒ",
      "duration": 45,
      "environment": "æœºæˆ¿"
    },
    "user_intent": "æƒ³ç”¨Orangeè®©å­¦ç”Ÿç†è§£KNNåˆ†ç±»åŸç†"
  }
}
ä½œç”¨ï¼š
â€¢ ä½œä¸º Task çš„èµ·ç‚¹ä¹‹ä¸€ï¼ˆä¸ scenario å¹¶åˆ—ï¼‰
â€¢ å¯¹åç»­ Stage å½¢æˆå¼ºçº¦æŸ
â€¢ åå‘é©±åŠ¨ scenario / driving_question çš„ç”Ÿæˆ
---
5. Stage ä¾èµ–å…³ç³»ç³»ç»Ÿ
5.1 ä¾èµ–é…ç½®ï¼ˆç¡¬ç¼–ç ï¼‰
STAGE_DEPENDENCIES = {
    "scenario": [],                          # åŸºç¡€èµ·ç‚¹
    "driving_question": ["scenario"],        # ä¾èµ–åœºæ™¯
    "question_chain": ["driving_question"],  # ä¾èµ–é©±åŠ¨é—®é¢˜
    "activity": ["question_chain"],          # ä¾èµ–é—®é¢˜é“¾
    "experiment": ["activity"]               # ä¾èµ–æ´»åŠ¨
}

# Tool Seed å…¥å£çš„ç‰¹æ®Šä¾èµ–
TOOL_SEED_DEPENDENCIES = {
    "scenario": ["tool_seed"],               # åœºæ™¯éœ€å¯¹é½å·¥å…·
    "activity": ["question_chain", "tool_seed"]  # æ´»åŠ¨éœ€åŒé‡å¯¹é½
}
5.2 æµç¨‹è·¯å¾„å¯¹æ¯”
æ ‡å‡†æ­£å‘è·¯å¾„
scenario â†’ driving_question â†’ question_chain â†’ activity â†’ experiment
åå‘èµ·ç‚¹è·¯å¾„ï¼ˆTool Seedï¼‰
tool_seed
    â†“
scenarioï¼ˆè¡¥å…¨ - éœ€é€‚é…å·¥å…·ç‰¹æ€§ï¼‰
    â†“
driving_question
    â†“
question_chain
    â†“
activityï¼ˆå¼ºåˆ¶å¯¹é½ tool_seed çº¦æŸï¼‰
5.3 ä¾èµ–æ£€æŸ¥æœºåˆ¶
ç³»ç»Ÿä¼šåœ¨æ¨è¿›å‰ è‡ªåŠ¨æ£€æŸ¥ä¾èµ–æ˜¯å¦å­˜åœ¨ï¼š
â€¢ è‹¥ç¼ºå¤± â†’ è§¦å‘åå‘è¡¥å…¨
â€¢ è‹¥å†²çª â†’ æç¤ºç”¨æˆ·è°ƒæ•´å‰åºé€‰æ‹©
---
6. å†³ç­–ä¸æµç¨‹æ§åˆ¶å±‚ï¼ˆDecision & Flow Controlï¼‰
6.1 èŒè´£å‡çº§
é™¤åŸæœ‰èŒè´£å¤–ï¼Œæ–°å¢ï¼š
æ–°å¢èŒè´£	è¯´æ˜
å‰ç½®ä¾èµ–æ£€æŸ¥	åˆ¤æ–­å½“å‰æ˜¯å¦å­˜åœ¨æœªæ»¡è¶³çš„å‰ç½®ä¾èµ–
æµç¨‹æ–¹å‘å†³ç­–	æ­£å‘æ¨è¿› / åå‘è¡¥å…¨ / åœæ­¢ç­‰å¾…ç”¨æˆ·
çº¦æŸå†²çªæ£€æµ‹	æ£€æŸ¥ tool_seed ä¸ç”Ÿæˆå†…å®¹çš„å…¼å®¹æ€§
6.2 å†³ç­–è¾“å‡ºç¤ºä¾‹
åœºæ™¯ï¼šTool Seed èµ·æ­¥ï¼Œéœ€å…ˆç”Ÿæˆ scenario
{
  "decision": {
    "next_stage": "scenario",
    "direction": "backward_completion",
    "explanation": {
      "system": "activity ä¾èµ– scenarioï¼Œä½†å½“å‰ä¸å­˜åœ¨",
      "user": "ä½ å·²ç»ç¡®å®šè¦ä½¿ç”¨ Orange è¿›è¡Œ KNN å®æ“ï¼Œç°åœ¨éœ€è¦å…ˆæ„å»ºä¸€ä¸ªåˆé€‚çš„æ•™å­¦åœºæ™¯ã€‚"
    },
    "user_message": "æˆ‘å°†ä¸ºä½ ç”Ÿæˆ 3 ä¸ªé€‚åˆè¯¥å·¥å…·çš„è¯¾å ‚åœºæ™¯ï¼Œè¯·é€‰æ‹©ä¸€ä¸ªã€‚",
    "constraints": {
      "must_align_with": ["tool_seed"],
      "candidate_count": 3
    }
  }
}
---
7. Stage ç”Ÿæˆå™¨ï¼ˆStage Generatorï¼‰
7.1 å¼ºåˆ¶è§„åˆ™
â€¢ æ¯ä¸ª Stage å¿…é¡»ç”Ÿæˆ â‰¥3 ä¸ªå€™é€‰æ–¹æ¡ˆ
â€¢ æ¯ä¸ªå€™é€‰å¿…é¡»åŒ…å«å®Œæ•´å…ƒæ•°æ®
7.2 å€™é€‰æ–¹æ¡ˆç»“æ„
{
  "stage": "scenario",
  "candidates": [
    {
      "id": "A",
      "content": {
        "title": "æ°´æœåˆ†ç±»å¤§å¸ˆ",
        "description": "å­¦ç”Ÿæ‰®æ¼”æ°´æœåº—AIåŠ©æ‰‹ï¼Œé€šè¿‡ç‰¹å¾åˆ†ç±»æ°´æœ...",
        "setting": "æ¨¡æ‹Ÿæ°´æœåº—åœºæ™¯",
        "roles": ["AIåŠ©æ‰‹", "é¡¾å®¢", "åº—é•¿"]
      },
      "rationale": "é€‚åˆ Orange çš„å¯è§†åŒ–æ“ä½œï¼Œèƒ½ç›´è§‚å±•ç¤ºKNNåˆ†ç±»è¿‡ç¨‹",
      "derived_from": ["tool_seed"],
      "alignment_score": 0.95,
      "estimated_duration": 45
    },
    {
      "id": "B",
      "content": { "...": "..." },
      "rationale": "å¼ºè°ƒå‚æ•°è°ƒèŠ‚ï¼Œé€‚åˆç†è§£Kå€¼å½±å“",
      "derived_from": ["tool_seed"],
      "alignment_score": 0.88
    },
    {
      "id": "C",
      "content": { "...": "..." },
      "rationale": "ç»“åˆå³æ—¶åé¦ˆç‰¹æ€§ï¼Œå¢å¼ºå­¦ç”Ÿå‚ä¸æ„Ÿ",
      "derived_from": ["tool_seed"],
      "alignment_score": 0.82
    }
  ],
  "generation_context": {
    "based_on": ["tool_seed"],
    "constraints_applied": ["grade:åˆäºŒ", "duration:45"]
  }
}
---
8. å¤šæ–¹æ¡ˆåˆ†æ”¯ç®¡ç†ç³»ç»Ÿ
8.1 åˆ†æ”¯ç”Ÿå‘½å‘¨æœŸ
ç”Ÿæˆå€™é€‰æ–¹æ¡ˆ â†’ ç”¨æˆ·é€‰æ‹© â†’ åˆ†æ”¯é”å®š â†’ å‰ªé™¤æœªé€‰åˆ†æ”¯ â†’ ç»§ç»­ä¸‹ä¸€Stage
8.2 ç³»ç»Ÿè®°å½•ç­–ç•¥
è®°å½•å†…å®¹	ç”¨é€”	ä¿ç•™ç­–ç•¥
å·²é€‰æ–¹æ¡ˆ	æ„å»ºå½“å‰è¯¾ç¨‹	æ°¸ä¹…ä¿ç•™
æœªé€‰æ–¹æ¡ˆ	å›æ”¾/è°ƒè¯•/é‡æ–°é€‰æ‹©	ä¿ç•™è‡³ Task å®Œæˆ
é€‰æ‹©å†å²	å†³ç­–è·¯å¾„è¿½æº¯	æ°¸ä¹…ä¿ç•™
8.3 åˆ†æ”¯æ”¶æ•›è§„åˆ™
â€¢ æ¯æ¬¡é€‰æ‹©åï¼Œå…¶ä»–åˆ†æ”¯è¢«å†»ç»“ï¼ˆéåˆ é™¤ï¼‰
â€¢ ç”¨æˆ·å¯åœ¨å½“å‰ Stage é‡æ–°ç”Ÿæˆå€™é€‰ï¼ˆæ–°å¼€åˆ†æ”¯ï¼‰
â€¢ ä¸æ”¯æŒè·¨ Stage å›é€€ï¼ˆä¿æŒå†³ç­–ä¸¥è‚ƒæ€§ï¼‰
---
9. Activity åå‘å¯¹é½æœºåˆ¶ï¼ˆå…³é”®ï¼‰
9.1 åŒé‡çº¦æŸæ£€æŸ¥
å½“ç”Ÿæˆ Activity æ—¶ï¼Œå¿…é¡»åŒæ—¶æ»¡è¶³ï¼š
çº¦æŸ1: æ•™å­¦é—®é¢˜çº¦æŸï¼ˆæ¥è‡ª question_chainï¼‰
çº¦æŸ2: å·¥å…·ç‰¹æ€§çº¦æŸï¼ˆæ¥è‡ª tool_seedï¼‰
9.2 å†²çªå¤„ç†æµç¨‹
æ£€æµ‹åˆ°å†²çª
    â†“
ç”Ÿæˆè§£é‡Šæ€§æç¤ºï¼ˆè¯´æ˜å†²çªç‚¹ï¼‰
    â†“
æä¾›è§£å†³æ–¹æ¡ˆï¼š
  A. è°ƒæ•´ tool_seed å‚æ•°
  B. é‡æ–°é€‰æ‹© question_chain
  C. ç”ŸæˆæŠ˜ä¸­æ–¹æ¡ˆï¼ˆæ ‡æ³¨å¦¥åç‚¹ï¼‰
    â†“
ç­‰å¾…ç”¨æˆ·å†³ç­–
9.3 å¯¹é½éªŒè¯ç¤ºä¾‹
{
  "validation": {
    "stage": "activity",
    "checks": [
      {
        "constraint": "tool_seed.affordances",
        "required": ["åˆ†ç±»å¯è§†åŒ–", "å‚æ•°è°ƒèŠ‚"],
        "matched": ["åˆ†ç±»å¯è§†åŒ–"],
        "missing": ["å‚æ•°è°ƒèŠ‚"],
        "severity": "warning"
      },
      {
        "constraint": "question_chain.core_questions",
        "required": ["å¦‚ä½•é€‰æ‹©Kå€¼"],
        "matched": ["å¦‚ä½•é€‰æ‹©Kå€¼"],
        "severity": "pass"
      }
    ],
    "recommendation": "å»ºè®®åœ¨æ´»åŠ¨ä¸­å¢åŠ å‚æ•°è°ƒèŠ‚ç¯èŠ‚ï¼Œä»¥å……åˆ†åˆ©ç”¨ Orange çš„ç‰¹æ€§"
  }
}
---
10. LangGraph èŠ‚ç‚¹å®šä¹‰ï¼ˆåç«¯å®ç°ï¼‰
10.1 å®šä½ç¡®è®¤
LangGraph =ã€Œæµç¨‹ä¸ä¾èµ–æ§åˆ¶å™¨ã€
â€¢ âŒ ä¸è´Ÿè´£ç”Ÿæˆ
â€¢ âŒ ä¸è´Ÿè´£è§£é‡Š
â€¢ âŒ ä¸ç›´æ¥å’Œç”¨æˆ·è¯´è¯
â€¢ âœ… åªè´Ÿè´£ï¼šä¸‹ä¸€æ­¥"å…ä¸å…è®¸ / è¯¥ä¸è¯¥ / ç¼ºä¸ç¼º"
10.2 Graph èŠ‚ç‚¹æ€»è§ˆ
[entry_node]
      â”‚
      â–¼
[dependency_check_node] â”€â”€(missing deps)â”€â”€â–º [require_previous_stage]
      â”‚
      â–¼
[candidate_stage_node]
      â”‚
      â–¼
[user_choice_gate]
      â”‚
      â–¼
[stage_finalize_node]
      â”‚
      â–¼
[graph_end]
10.3 èŠ‚ç‚¹è¯¦ç»†å®šä¹‰
1ï¸âƒ£ entry_nodeï¼ˆå…¥å£èŠ‚ç‚¹ï¼‰
èŒè´£ï¼š åˆå§‹åŒ– Graph Contextï¼ŒåŠ è½½ Task çŠ¶æ€
è¾“å…¥ï¼š
{
  "task_id": "task_abc123",
  "current_stage": "activity",
  "entry_point": "tool_seed"
}
è¾“å‡ºï¼š
{
  "graph_context": {
    "task_id": "task_abc123",
    "current_stage": "activity",
    "entry_point": "tool_seed",
    "completed_stages": ["tool_seed"],
    "timestamp": "2026-02-20T10:00:00Z"
  }
}
---
2ï¸âƒ£ dependency_check_nodeï¼ˆæ ¸å¿ƒèŠ‚ç‚¹ï¼‰
èŒè´£ï¼š åˆ¤æ–­å½“å‰ Stage èƒ½å¦ç›´æ¥ç”Ÿæˆ
å¤„ç†é€»è¾‘ï¼š
def check_dependencies(current_stage, entry_point, completed_stages):
    # è·å–ä¾èµ–é…ç½®
    deps = STAGE_DEPENDENCIES.get(current_stage, [])
    
    # å¦‚æœæ˜¯ tool_seed å…¥å£ï¼Œè¿½åŠ ç‰¹æ®Šä¾èµ–
    if entry_point == "tool_seed" and current_stage in TOOL_SEED_DEPENDENCIES:
        deps += TOOL_SEED_DEPENDENCIES[current_stage]
    
    # æ£€æŸ¥ç¼ºå¤±
    missing = [d for d in deps if d not in completed_stages]
    
    return {
        "can_proceed": len(missing) == 0,
        "missing": missing,
        "required": deps
    }
è¾“å‡ºåˆ†æ”¯ï¼š
â€¢ âœ… ä¾èµ–æ»¡è¶³ â†’ æµå‘ candidate_stage_node
â€¢ âŒ ä¾èµ–ç¼ºå¤± â†’ æµå‘ require_previous_stage
---
3ï¸âƒ£ require_previous_stageï¼ˆåå‘è¡¥å…¨è§¦å‘ï¼‰
èŒè´£ï¼š é€šçŸ¥ä¸Šå±‚ç³»ç»Ÿéœ€å…ˆè¡¥å…¨å‰ç½® Stage
è¾“å‡ºï¼š
{
  "action": "require_completion",
  "force_next_stage": "scenario",
  "reason": "activity ä¾èµ– scenarioï¼Œä½†å½“å‰ä¸å­˜åœ¨",
  "blocking_stage": "activity",
  "missing_dependency": "scenario"
}
âš ï¸ æ­¤èŠ‚ç‚¹ä¸ç”Ÿæˆå†…å®¹ï¼Œä»…è¿”å›æ§åˆ¶ä¿¡å·
---
4ï¸âƒ£ candidate_stage_nodeï¼ˆå€™é€‰ç”Ÿæˆè§¦å‘å™¨ï¼‰
èŒè´£ï¼š è§¦å‘ Stage ç”Ÿæˆï¼ŒæŒ‡å®šå€™é€‰æ•°é‡
è¾“å‡ºï¼š
{
  "action": "generate_candidates",
  "stage_to_generate": "scenario",
  "candidate_required": 3,
  "constraints": {
    "must_align_with": ["tool_seed"],
    "context": { "tool_seed": {...} }
  }
}
---
5ï¸âƒ£ user_choice_gateï¼ˆåˆ†æ”¯æ”¶æ•›ç‚¹ï¼‰
èŒè´£ï¼š ç­‰å¾…å¹¶å¤„ç†ç”¨æˆ·é€‰æ‹©ï¼Œé”å®šåˆ†æ”¯
è¾“å…¥ï¼š
{
  "selected_candidate_id": "B",
  "candidate_pool": ["A", "B", "C"]
}
è¾“å‡ºï¼š
{
  "action": "finalize_choice",
  "branch_locked": true,
  "active_candidate": "B",
  "pruned_branches": ["A", "C"],
  "next_stage": "driving_question"
}
---
6ï¸âƒ£ stage_finalize_nodeï¼ˆçŠ¶æ€è½ç›˜ï¼‰
èŒè´£ï¼š æ ‡è®° Stage å®Œæˆï¼Œæ›´æ–° Task çŠ¶æ€
è¾“å‡ºï¼š
{
  "action": "stage_completed",
  "completed_stage": "scenario",
  "task_update": {
    "completed_stages": ["tool_seed", "scenario"],
    "current_stage": "driving_question",
    "status": "active"
  }
}
---
10.4 Graph ä¸ä¸Šå±‚ç³»ç»Ÿäº¤äº’
æ¥å…¥ç‚¹ 1ï¼šDecision Layer å‰è°ƒç”¨
ç”¨æˆ·æ“ä½œ
    â†“
ç»„è£… Task State
    â†“
LangGraph.run(task_state)
    â†“
è·å–ç»“æœï¼šnext_stage / missing / action
    â†“
Decision Layer ç”Ÿæˆäººè¯è§£é‡Š
    â†“
è¿”å›ç»™ç”¨æˆ·
æ¥å…¥ç‚¹ 2ï¼šStage Generator å‰æ ¡éªŒ
æƒ³ç”Ÿæˆ activity
    â†“
Graph æ£€æŸ¥ï¼šä¾èµ–ä¸æ»¡è¶³ï¼ˆç¼º scenarioï¼‰
    â†“
æ”¹ç”Ÿæˆ scenario
    â†“
è¿”å› tool_seed â†’ scenario çš„è½¬æ¢è§£é‡Š
---
11. ç”¨æˆ·çœŸå®ä½“éªŒæµç¨‹
11.1 å®Œæ•´äº¤äº’ç¤ºä¾‹ï¼ˆTool Seed å…¥å£ï¼‰
æ­¥éª¤	ç³»ç»Ÿè¡Œä¸º	ç”¨æˆ·æ„ŸçŸ¥
1	ç”¨æˆ·è¾“å…¥ï¼š"æˆ‘æƒ³ç”¨ Orange åš KNN"	ğŸŸ  æˆ‘æƒ³ç”¨ Orange åš KNN
2	Graph æ£€æµ‹åˆ°éœ€è¡¥å…¨ scenarioï¼ŒDecision Layer ç”Ÿæˆè§£é‡Š	ğŸ¤– ç»™ä½  3 ä¸ªåˆé€‚çš„æ•™å­¦åœºæ™¯
3	Stage Generator ç”Ÿæˆ 3 ä¸ªå€™é€‰æ–¹æ¡ˆ	ï¼ˆå±•ç¤º 3 ä¸ªåœºæ™¯å¡ç‰‡ï¼‰
4	ç”¨æˆ·é€‰æ‹©åœºæ™¯ B	ğŸ‘‰ é€‰ä¸€ä¸ªï¼ˆç‚¹å‡» Bï¼‰
5	Graph é”å®šåˆ†æ”¯ï¼Œè§¦å‘ driving_question ç”Ÿæˆ	ğŸ¤– åŸºäºè¿™ä¸ªåœºæ™¯ï¼Œç”Ÿæˆ 3 ä¸ªé©±åŠ¨é—®é¢˜
6	ç”¨æˆ·é€‰æ‹©é—®é¢˜ C	ğŸ‘‰ é€‰ä¸€ä¸ªï¼ˆç‚¹å‡» Cï¼‰
7	Graph æ£€æŸ¥ä¾èµ–æ»¡è¶³ï¼Œè§¦å‘ activity ç”Ÿæˆï¼ˆåŒé‡å¯¹é½ï¼‰	ğŸ¤– åŸºäºè¿™ä¸ªé—®é¢˜ï¼Œè®¾è®¡ä¸€æ•´å¥— Orange æ´»åŠ¨
8	ç”Ÿæˆå®Œæ•´è¯¾ç¨‹æ´»åŠ¨	âœ… ä¸€èŠ‚è¯¾å®Œæˆ
11.2 ç³»ç»Ÿéšèº«ä¿è¯
ç”¨æˆ·çœ¼é‡Œï¼š æµç•…çš„å¯¹è¯å¼è¯¾ç¨‹è®¾è®¡åŠ©æ‰‹
å®é™…åå°ï¼š LangGraph ä¸¥æ ¼ç®¡ç†ä¾èµ–å’Œåˆ†æ”¯ï¼Œç¡®ä¿æµç¨‹æ­£ç¡®
---
12. æ•°æ®æ¨¡å‹å®šä¹‰
12.1 Task æ¨¡å‹
interface Task {
  task_id: string;           // å”¯ä¸€æ ‡è¯†
  session_id: string;        // æ‰€å±ä¼šè¯
  entry_point: EntryPoint;   // èµ·ç‚¹ç±»å‹ï¼šscenario | tool_seed
  
  current_stage: StageType;  // å½“å‰è¿›è¡Œä¸­çš„é˜¶æ®µ
  completed_stages: StageType[];  // å·²å®Œæˆé˜¶æ®µ
  
  status: 'active' | 'completed' | 'abandoned';
  
  // èµ·ç‚¹æ•°æ®
  entry_data: Scenario | ToolSeed;
  
  // å„é˜¶æ®µäº§ç‰©
  artifacts: {
    scenario?: ScenarioArtifact;
    driving_question?: DrivingQuestionArtifact;
    question_chain?: QuestionChainArtifact;
    activity?: ActivityArtifact;
    experiment?: ExperimentArtifact;
  };
  
  created_at: DateTime;
  updated_at: DateTime;
}

type EntryPoint = 'scenario' | 'tool_seed';
type StageType = 'scenario' | 'driving_question' | 'question_chain' | 'activity' | 'experiment';
12.2 Stage äº§ç‰©æ¨¡å‹
interface StageArtifact {
  stage_id: string;
  stage_type: StageType;
  
  // å€™é€‰æ–¹æ¡ˆï¼ˆç”Ÿæˆæ—¶ï¼‰
  candidates: Candidate[];
  
  // æœ€ç»ˆé€‰æ‹©
  selected_candidate?: Candidate;
  
  // ç”Ÿæˆå…ƒæ•°æ®
  generation_context: {
    based_on: string[];      // ä¾èµ–æ¥æº
    constraints: Record<string, any>;
    timestamp: DateTime;
  };
  
  status: 'generating' | 'pending_choice' | 'finalized';
}

interface Candidate {
  id: string;                // A, B, C
  content: any;              // é˜¶æ®µç‰¹å®šå†…å®¹
  rationale: string;         // ç”Ÿæˆç†ç”±
  derived_from: string[];    // ä¾èµ–æ¥æº
  alignment_score?: number;  // å¯¹é½åº¦è¯„åˆ†
}
12.3 Tool Seed æ¨¡å‹
interface ToolSeed {
  tool_name: string;         // Orange, Scratch, etc.
  algorithm?: string[];      // KNN, å†³ç­–æ ‘, etc.
  
  affordances: string[];     // å·¥å…·èƒ½åŠ›ï¼šå¯è§†åŒ–ã€å‚æ•°è°ƒèŠ‚ç­‰
  
  constraints: {
    grade?: string;          // å¹´çº§
    duration?: number;       // è¯¾æ—¶
    environment?: string;    // è¯¾å ‚/æœºæˆ¿
    materials?: string[];    // ææ–™é™åˆ¶
  };
  
  user_intent: string;       // åŸå§‹è¾“å…¥
  extracted_entities?: any;  // NLP æå–çš„å®ä½“
}
---
13. API æ¥å£è®¾è®¡
13.1 Task ç®¡ç†æ¥å£
POST   /api/tasks                    # åˆ›å»ºæ–° Task
GET    /api/tasks/{task_id}          # è·å– Task çŠ¶æ€
POST   /api/tasks/{task_id}/action   # æäº¤ç”¨æˆ·æ“ä½œï¼ˆé€‰æ‹©/ä¿®æ”¹/ç¡®è®¤ï¼‰
GET    /api/tasks/{task_id}/progress # è·å–è¿›åº¦å’Œå½“å‰çŠ¶æ€
13.2 æ ¸å¿ƒ Action æ¥å£
// æäº¤ç”¨æˆ·é€‰æ‹©
POST /api/tasks/{task_id}/action
{
  "action_type": "select_candidate",
  "payload": {
    "stage": "scenario",
    "candidate_id": "B"
  }
}

// è¯·æ±‚é‡æ–°ç”Ÿæˆ
{
  "action_type": "regenerate_candidates",
  "payload": {
    "stage": "driving_question",
    "feedback": "å¸Œæœ›é—®é¢˜æ›´è´´è¿‘ç”Ÿæ´»"
  }
}

// ä» Tool Seed å¯åŠ¨
POST /api/tasks
{
  "entry_point": "tool_seed",
  "tool_seed": {
    "tool_name": "Orange",
    "algorithm": ["KNN"],
    "constraints": { "grade": "åˆäºŒ" }
  }
}
---
14. é”™è¯¯å¤„ç†ä¸è¾¹ç•Œæƒ…å†µ
14.1 å¸¸è§å¼‚å¸¸åœºæ™¯
åœºæ™¯	æ£€æµ‹ç‚¹	å¤„ç†ç­–ç•¥
Tool Seed ä¸ Scenario å†²çª	dependency_check_node	æç¤ºè°ƒæ•´ tool_seed æˆ–é‡æ–°é€‰æ‹©
ç”Ÿæˆå†…å®¹ä¸æ»¡è¶³çº¦æŸ	Stage Generator éªŒè¯	æ ‡è®° warningï¼Œæä¾›å¦¥åæ–¹æ¡ˆ
ç”¨æˆ·é•¿æ—¶é—´æœªé€‰æ‹©	Task Manager è¶…æ—¶æ£€æŸ¥	å‘é€æé†’ï¼Œæ”¯æŒä¿å­˜è‰ç¨¿
å¤šä¾èµ–åŒæ—¶ç¼ºå¤±	dependency_check_node	æŒ‰æ‹“æ‰‘æ’åºä¾æ¬¡è¡¥å…¨
14.2 é™çº§ç­–ç•¥
â€¢ LLM ä¸å¯ç”¨ï¼š è¿”å›é¢„è®¾æ¨¡æ¿ + æç¤ºç”¨æˆ·æ‰‹åŠ¨ç¼–è¾‘
â€¢ ç”Ÿæˆè´¨é‡ä½ï¼š æä¾›"é‡æ–°ç”Ÿæˆ"å’Œ"æ‰‹åŠ¨è¾“å…¥"é€‰é¡¹
â€¢ ä¾èµ–å¾ªç¯ï¼š Graph å±‚æ£€æµ‹å¹¶æŠ›å‡ºæ˜ç¡®é”™è¯¯
---
15. éƒ¨ç½²ä¸æ‰©å±•
15.1 æŠ€æœ¯æ ˆå»ºè®®
å±‚çº§	æŠ€æœ¯é€‰å‹
Web UI	React/Vue + TypeScript
API Server	FastAPI (Python)
Task Manager	Redis + PostgreSQL
LLM å±‚	OpenAI API / Claude / æœ¬åœ°æ¨¡å‹
LangGraph	Python ç‰ˆæœ¬ï¼Œç‹¬ç«‹æœåŠ¡
çŸ¥è¯†åº“	Vector DB (Pinecone/Weaviate)
15.2 æ‰©å±•æ€§è®¾è®¡
â€¢ æ–°å¢ Stageï¼š ä¿®æ”¹ STAGE_DEPENDENCIES é…ç½®ï¼Œæ— éœ€æ”¹ Prompt
â€¢ æ–°å¢ Toolï¼š æ‰©å±• Tool Seed å®šä¹‰ï¼Œè‡ªåŠ¨ç»§æ‰¿çº¦æŸæ£€æŸ¥
â€¢ å¤šè¯­è¨€æ”¯æŒï¼š Stage Generator å±‚æ·»åŠ  i18n æ¨¡æ¿
---
16. æ¶æ„å…±è¯†æ€»ç»“
16.1 004 æ¶æ„çš„çœŸæ­£å®šä½
ç»„ä»¶	æœ¬è´¨	è¾¹ç•Œ
LangGraph	æµç¨‹çº¦æŸå¼•æ“ã€ä¾èµ–è¡¥å…¨ç³»ç»Ÿã€å¤šæ–¹æ¡ˆåˆ†æ”¯è®°å½•å™¨	ä¸ç”Ÿæˆã€ä¸è§£é‡Šã€ä¸å¯¹è¯
LLM	å†³ç­–è€…ã€è§£é‡Šè€…ã€å†…å®¹ç”Ÿæˆè€…	ä¸ç®¡ç†çŠ¶æ€ã€ä¸æ§åˆ¶æµç¨‹
ç”¨æˆ·çœ‹åˆ°	ã€Œæˆ‘ä»¬ç°åœ¨åœ¨å¹²å˜›ã€ã€ã€Œä¸ºä»€ä¹ˆã€ã€ã€Œè½®åˆ°ä½ äº†ã€	ä¸çŸ¥é“ LangGraph å­˜åœ¨
16.2 å…³é”®æˆåŠŸæŒ‡æ ‡
â€¢ âœ… ç”¨æˆ·å…¨ç¨‹ä¸æ„ŸçŸ¥ LangGraph å­˜åœ¨
â€¢ âœ… ä» Tool Seed èµ·æ­¥çš„æµç¨‹ä¸ä» Scenario èµ·æ­¥çš„æµç¨‹ä½“éªŒä¸€è‡´
â€¢ âœ… æ¯ä¸ªç³»ç»Ÿè¡Œä¸ºéƒ½æœ‰æ˜ç¡®çš„ç”¨æˆ·è§£é‡Š
â€¢ âœ… æ”¯æŒéšæ—¶äººå·¥ä»‹å…¥å’Œä¿®æ”¹
â€¢ âœ… æ–°å¢ Stage æˆ– Tool æ— éœ€ä¿®æ”¹æ ¸å¿ƒ Prompt
---
17. é™„å½•
17.1 æœ¯è¯­è¡¨
æœ¯è¯­	å®šä¹‰
004 æ¶æ„	æœ¬ç³»ç»Ÿæ¶æ„çš„æ­£å¼å‘½å
Stage	è¯¾ç¨‹æ„å»ºçš„æµç¨‹å•ä½ï¼ˆåœºæ™¯ã€é—®é¢˜ã€æ´»åŠ¨ç­‰ï¼‰
Tool Seed	ä»å·¥å…·/æ´»åŠ¨å‡ºå‘çš„åå‘å…¥å£
åå‘è¡¥å…¨	ä»åå¾€å‰ç”Ÿæˆç¼ºå¤±çš„å‰ç½® Stage
å€™é€‰æ–¹æ¡ˆ	æ¯ä¸ª Stage ç”Ÿæˆçš„ 3 ä¸ªå¯é€‰å†…å®¹
åˆ†æ”¯é”å®š	ç”¨æˆ·é€‰æ‹©åå†»ç»“å…¶ä»–å€™é€‰
17.2 å˜æ›´æ—¥å¿—
ç‰ˆæœ¬	æ—¥æœŸ	å˜æ›´å†…å®¹
v4.0	2026-02-20	åˆå§‹ç‰ˆæœ¬ï¼Œæ”¯æŒçº¿æ€§æµç¨‹
v4.1	2026-02-20	æ–°å¢ Tool Seed å…¥å£ã€åå‘è¡¥å…¨ã€å¤šæ–¹æ¡ˆåˆ†æ”¯

ä¾‹å­1ï¼šæ ¹æ®æ‚¨çš„è®¾è®¡æ–‡æ¡£ï¼Œæ˜¯çš„ï¼Œç”¨æˆ·å¯ä»¥ä»ä»»æ„èŠ‚ç‚¹è¿›å…¥ï¼Œä½†éœ€è¦æ»¡è¶³ç‰¹å®šçš„ä¾èµ–æ¡ä»¶ã€‚è®©æˆ‘è¯¦ç»†è¯´æ˜è¿™ä¸ªæœºåˆ¶ï¼š
---
å¤šèµ·ç‚¹è¿›å…¥æœºåˆ¶è¯¦è§£
1. æ”¯æŒçš„å…¥å£ç‚¹ï¼ˆEntry Pointsï¼‰
å…¥å£ç‚¹	åœºæ™¯æè¿°	è‡ªåŠ¨è§¦å‘è¡Œä¸º
scenario	ä»æ•™å­¦åœºæ™¯å¼€å§‹	æ­£å‘æ¨è¿›ï¼šscenario â†’ driving_question â†’ ...
tool_seed	ä»å·¥å…·/æ´»åŠ¨å¼€å§‹	åå‘è¡¥å…¨ï¼šå…ˆè¡¥ scenario â†’ å†æ­£å‘æ¨è¿›
driving_question	ç›´æ¥è¾“å…¥é©±åŠ¨é—®é¢˜	æ£€æŸ¥å¹¶è¡¥å…¨ scenario
question_chain	ç›´æ¥è¾“å…¥é—®é¢˜é“¾	æ£€æŸ¥å¹¶è¡¥å…¨ scenario + driving_question
activity	ç›´æ¥è¾“å…¥æ´»åŠ¨è®¾è®¡	æ£€æŸ¥å¹¶è¡¥å…¨æ‰€æœ‰å‰ç½®ä¾èµ–
---
2. ä»»æ„èŠ‚ç‚¹è¿›å…¥çš„å¤„ç†æµç¨‹
ç”¨æˆ·é€‰æ‹©ä» [ä»»æ„Stage] è¿›å…¥
           â†“
    [entry_node] æ¥æ”¶ entry_point
           â†“
    [dependency_check_node] æ£€æŸ¥ä¾èµ–
           â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
    â–¼             â–¼
ä¾èµ–æ»¡è¶³        ä¾èµ–ç¼ºå¤±
    â†“             â†“
ç›´æ¥ç”Ÿæˆ    [require_previous_stage]
è¯¥Stage         â†“
           è¿”å›ç¼ºå¤±åˆ—è¡¨
                â†“
           Decision Layer ç”Ÿæˆè§£é‡Š
                â†“
           è‡ªåŠ¨è¿›å…¥åå‘è¡¥å…¨æµç¨‹
---
3. å…·ä½“ç¤ºä¾‹ï¼šä» Activity èŠ‚ç‚¹è¿›å…¥
ç”¨æˆ·è¾“å…¥
"æˆ‘æƒ³è®¾è®¡ä¸€ä¸ªç”¨ Orange åš KNN åˆ†ç±»çš„è¯¾å ‚æ´»åŠ¨"
ç³»ç»Ÿå¤„ç†æµç¨‹
Step 1: Entry Node è¯†åˆ«
{
  "entry_point": "activity",
  "user_input": "ç”¨ Orange åš KNN åˆ†ç±»çš„è¯¾å ‚æ´»åŠ¨",
  "extracted_tool_seed": {
    "tool_name": "Orange",
    "algorithm": ["KNN"]
  }
}
Step 2: Dependency Check
# æ£€æŸ¥ activity çš„ä¾èµ–
dependencies = ["question_chain", "tool_seed"]  # æ ¹æ®é…ç½®

# å½“å‰å·²å®Œæˆï¼š[]
# ç¼ºå¤±ï¼š["scenario", "driving_question", "question_chain", "tool_seed"]
Step 3: è‡ªåŠ¨åˆ›å»º Tool Seedç³»ç»Ÿä»ç”¨æˆ·è¾“å…¥ä¸­æå–å·¥å…·ä¿¡æ¯ï¼Œè‡ªåŠ¨åˆ›å»º Tool Seed Stage
Step 4: åå‘è¡¥å…¨è§¦å‘
{
  "action": "backward_completion",
  "current_intent": "activity",
  "missing_chain": [
    {"stage": "tool_seed", "status": "auto_created"},
    {"stage": "scenario", "status": "pending"},
    {"stage": "driving_question", "status": "pending"},
    {"stage": "question_chain", "status": "pending"}
  ],
  "next_action": "generate scenario based on tool_seed"
}
Step 5: Decision Layer ç”Ÿæˆç”¨æˆ·è§£é‡Š
ğŸ¤– "æˆ‘æ³¨æ„åˆ°ä½ æƒ³è®¾è®¡ä¸€ä¸ª Orange KNN æ´»åŠ¨ã€‚ä¸ºäº†ç¡®ä¿æ´»åŠ¨è®¾è®¡åˆç†ï¼Œæˆ‘éœ€è¦å…ˆäº†è§£ä¸€äº›èƒŒæ™¯ï¼š
1. é¦–å…ˆï¼Œä¸ºä½ ç”Ÿæˆ 3 ä¸ªé€‚åˆ Orange KNN çš„æ•™å­¦åœºæ™¯
2. ç„¶ååŸºäºåœºæ™¯è®¾è®¡é©±åŠ¨é—®é¢˜
3. æœ€åè®¾è®¡å…·ä½“çš„æ´»åŠ¨æµç¨‹
è¿™æ ·å¯ä»¥ä¿è¯æ´»åŠ¨ä¸æ•™å­¦ç›®æ ‡ä¸€è‡´ã€‚æˆ‘ä»¬ç°åœ¨å¼€å§‹ç¬¬ä¸€æ­¥å—ï¼Ÿ"
---
4. ä¾èµ–é…ç½®æ”¯æŒä»»æ„å…¥å£
# æ‰©å±•çš„ä¾èµ–é…ç½®ï¼Œæ”¯æŒä»»æ„èµ·ç‚¹
STAGE_DEPENDENCIES = {
    "scenario": [],
    "driving_question": ["scenario"],
    "question_chain": ["driving_question"],
    "activity": ["question_chain"],
    "experiment": ["activity"]
}

# å…¥å£ç‚¹ç‰¹æ®Šå¤„ç†æ˜ å°„
ENTRY_POINT_HANDLERS = {
    "scenario": {
        "dependencies": [],
        "direction": "forward"
    },
    "tool_seed": {
        "dependencies": [],
        "auto_creates": "tool_seed",  # è‡ªåŠ¨åˆ›å»º
        "direction": "backward_first"  # å…ˆåå‘è¡¥å…¨
    },
    "driving_question": {
        "dependencies": ["scenario"],
        "missing_strategy": "generate_scenario_first",
        "direction": "backward_first"
    },
    "question_chain": {
        "dependencies": ["scenario", "driving_question"],
        "missing_strategy": "generate_missing_chain",
        "direction": "backward_first"
    },
    "activity": {
        "dependencies": ["scenario", "driving_question", "question_chain"],
        "extract_tool_seed": True,  # å°è¯•æå–å·¥å…·ä¿¡æ¯
        "direction": "backward_first"
    },
    "experiment": {
        "dependencies": ["scenario", "driving_question", "question_chain", "activity"],
        "direction": "backward_first"
    }
}
---
5. ç”¨æˆ·ç•Œé¢ä½“ç°
åœ¨ Web UI ä¸­ï¼Œå¯ä»¥æä¾›ä»¥ä¸‹å…¥å£é€‰é¡¹ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     ğŸ¯ é€‰æ‹©æ‚¨çš„è¯¾ç¨‹è®¾è®¡èµ·ç‚¹              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                         â”‚
â”‚  ğŸŸ¢ ä»æ•™å­¦åœºæ™¯å¼€å§‹                       â”‚
â”‚     "æˆ‘æœ‰ä¸€ä¸ªæ•™å­¦æƒ…å¢ƒæƒ³æ³•..."             â”‚
â”‚                                         â”‚
â”‚  ğŸ”§ ä»å·¥å…·/è½¯ä»¶å¼€å§‹ï¼ˆæ¨èï¼‰              â”‚
â”‚     "æˆ‘æƒ³ç”¨ Scratch/Python/Orange..."   â”‚
â”‚                                         â”‚
â”‚  â“ ä»é©±åŠ¨é—®é¢˜å¼€å§‹                       â”‚
â”‚     "æˆ‘æƒ³è®©å­¦ç”Ÿè§£å†³ä¸€ä¸ªé—®é¢˜..."           â”‚
â”‚                                         â”‚
â”‚  ğŸ“‹ ä»é—®é¢˜é“¾å¼€å§‹                         â”‚
â”‚     "æˆ‘å·²ç»æœ‰ä¸€ç»„æ¢ç©¶é—®é¢˜..."             â”‚
â”‚                                         â”‚
â”‚  ğŸ® ä»æ´»åŠ¨è®¾è®¡å¼€å§‹                       â”‚
â”‚     "æˆ‘æƒ³è®¾è®¡ä¸€ä¸ªå…·ä½“çš„è¯¾å ‚æ´»åŠ¨..."       â”‚
â”‚                                         â”‚
â”‚  ğŸ”¬ ä»å®éªŒè®¾è®¡å¼€å§‹                       â”‚
â”‚     "æˆ‘æƒ³è®¾è®¡ä¸€ä¸ªéªŒè¯æ€§å®éªŒ..."           â”‚
â”‚                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
---
6. å…³é”®ä¿è¯ï¼šæµç¨‹å§‹ç»ˆæ­£ç¡®
æ— è®ºç”¨æˆ·ä»å“ªä¸ªèŠ‚ç‚¹è¿›å…¥ï¼Œç³»ç»Ÿéƒ½ä¿è¯ï¼š
ä¿è¯é¡¹	æœºåˆ¶
ä¾èµ–å®Œæ•´	LangGraph å¼ºåˆ¶æ£€æŸ¥ï¼Œç¼ºå¤±å¿…è¡¥
çº¦æŸå¯¹é½	Tool Seed çº¦æŸè´¯ç©¿å…¨æµç¨‹
ç”¨æˆ·çŸ¥æƒ…	Decision Layer è§£é‡Šå½“å‰æ­¥éª¤
éšæ—¶ä»‹å…¥	ç”¨æˆ·å¯ä¿®æ”¹ä»»æ„å·²ç”Ÿæˆå†…å®¹
---
7. ä¸è€å¤ªå¤ªç”¨æˆ·çš„äº¤äº’ç¤ºä¾‹
è€å¤ªå¤ªï¼š "æˆ‘æƒ³ç›´æ¥è®¾è®¡ä¸€ä¸ªæ´»åŠ¨ï¼Œè®©å­¦ç”Ÿç”¨ç”µè„‘åšåˆ†ç±»"
ç³»ç»Ÿï¼š
ğŸ¤– "å¥½çš„ï¼Œæ‚¨æƒ³è®¾è®¡ä¸€ä¸ªç”µè„‘åˆ†ç±»çš„æ´»åŠ¨ã€‚ä¸ºäº†ç¡®ä¿è¿™ä¸ªæ´»åŠ¨æ•ˆæœå¥½ï¼Œæˆ‘éœ€è¦å…ˆé—®æ‚¨å‡ ä¸ªé—®é¢˜ï¼š
1. æ‚¨æ‰“ç®—ç”¨ä»€ä¹ˆè½¯ä»¶ï¼Ÿï¼ˆæ¯”å¦‚ Orangeã€Excelã€è¿˜æ˜¯ç¼–ç¨‹å·¥å…·ï¼Ÿï¼‰
2. å­¦ç”Ÿæ˜¯å‡ å¹´çº§ï¼Ÿ
3. æ‚¨å¸Œæœ›è§£å†³ä»€ä¹ˆå®é™…é—®é¢˜ï¼Ÿï¼ˆæ¯”å¦‚åˆ†è¾¨æ°´æœã€è¯†åˆ«æ¤ç‰©ã€è¿˜æ˜¯å…¶ä»–ï¼Ÿï¼‰
æˆ–è€…ï¼Œå¦‚æœæ‚¨è¿˜æ²¡æƒ³å¥½åœºæ™¯ï¼Œæˆ‘å¯ä»¥æ ¹æ®æ‚¨çš„å·¥å…·æ¨èå‡ ä¸ªæ•™å­¦åœºæ™¯ï¼Œæ‚¨é€‰ä¸€ä¸ªå–œæ¬¢çš„ï¼Œæˆ‘ä»¬å†ç»§ç»­è®¾è®¡æ´»åŠ¨ï¼Œå¥½å—ï¼Ÿ"
å…³é”®ç‚¹ï¼š
â€¢ ä¸æš´éœ²æŠ€æœ¯æœ¯è¯­ï¼ˆä¸è¯´ä¸å­˜åœ¨ LangGraphï¼‰
â€¢ ç”¨é—®é—®é¢˜çš„æ–¹å¼è¡¥å…¨ä¾èµ–
â€¢ ç»™ç”¨æˆ·é€‰æ‹©æƒï¼ˆè‡ªå·±è¾“å…¥æˆ–ç³»ç»Ÿæ¨èï¼‰
---
æ€»ç»“ï¼š004 æ¶æ„é€šè¿‡ dependency_check_node å’Œ require_previous_stage æœºåˆ¶ï¼Œå¤©ç„¶æ”¯æŒä»ä»»æ„èŠ‚ç‚¹è¿›å…¥ã€‚ç³»ç»Ÿä¼šè‡ªåŠ¨æ£€æµ‹ç¼ºå¤±çš„ä¾èµ–ï¼Œé€šè¿‡åå‘è¡¥å…¨æµç¨‹ç¡®ä¿è¯¾ç¨‹ç»“æ„å®Œæ•´ï¼ŒåŒæ—¶é€šè¿‡ Decision Layer å°†æŠ€æœ¯è¿‡ç¨‹è½¬åŒ–ä¸ºè‡ªç„¶çš„å¯¹è¯ä½“éªŒã€‚ã€

ä¾‹å­2ï¼š
å®Œå…¨å¯ä»¥ï¼è¿™æ­£æ˜¯ 004 æ¶æ„ è®¾è®¡çš„ç²¾é«“æ‰€åœ¨ã€‚è®©æˆ‘ä¸ºæ‚¨è¯¦ç»†è¯´æ˜"ä»å®éªŒèµ·æ­¥"çš„å®Œæ•´æœºåˆ¶ï¼š
---
ä»å®éªŒï¼ˆExperimentï¼‰èµ·æ­¥çš„å®Œæ•´æµç¨‹
1. ç”¨æˆ·åœºæ™¯
è€å¤ªå¤ªï¼š "æˆ‘æƒ³è®©å­¦ç”Ÿåšä¸€ä¸ªå®éªŒï¼Œç”¨ä¸åŒæµ“åº¦çš„ç›æ°´ï¼Œçœ‹çœ‹å¯¹æ¤ç‰©ç”Ÿé•¿æœ‰ä»€ä¹ˆå½±å“ï¼Œæœ€åè¦èƒ½ç”Ÿæˆä¸€ä»½ç§‘å­¦æŠ¥å‘Š"
è¿™å°±æ˜¯å…¸å‹çš„ ä» Experiment èŠ‚ç‚¹è¿›å…¥ï¼š
â€¢ å·²æœ‰æ˜ç¡®çš„å®éªŒæƒ³æ³•ï¼ˆç›æ°´æµ“åº¦ vs æ¤ç‰©ç”Ÿé•¿ï¼‰
â€¢ æœ‰äº§å‡ºè¦æ±‚ï¼ˆç§‘å­¦æŠ¥å‘Šï¼‰
â€¢ ä½†ç¼ºå°‘å‰ç½®çš„æ‰€æœ‰æ•™å­¦ç»“æ„
---
2. ç³»ç»Ÿå¤„ç†æµç¨‹
ç”¨æˆ·è¾“å…¥å®éªŒæƒ³æ³•
    â†“
[entry_node] è¯†åˆ« entry_point = "experiment"
    â†“
[dependency_check_node] æ£€æŸ¥ä¾èµ–é“¾
    â†“
å‘ç°ç¼ºå¤±ï¼š["activity", "question_chain", "driving_question", "scenario"]
    â†“
è‡ªåŠ¨æå–å®éªŒç‰¹å¾ï¼Œåˆ›å»º "experiment_seed"
    â†“
è§¦å‘åå‘è¡¥å…¨ï¼ˆä»æœ€æœ«ç«¯å¼€å§‹ï¼‰
    â†“
ä¾æ¬¡è¡¥å…¨ï¼šscenario â†’ driving_question â†’ question_chain â†’ activity
    â†“
æœ€åå¯¹é½ experimentï¼ˆéªŒè¯å¯è¡Œæ€§ï¼‰
---
3. Experiment Seed å®šä¹‰ï¼ˆæ–°å¢ï¼‰
{
  "entry_point": "experiment",
  "experiment_seed": {
    "title": "ç›æ°´æµ“åº¦å¯¹æ¤ç‰©ç”Ÿé•¿çš„å½±å“",
    "core_idea": "é€šè¿‡æ§åˆ¶ç›æ°´æµ“åº¦ï¼Œè§‚å¯Ÿæ¤ç‰©ç”Ÿé•¿å·®å¼‚",
    "experimental_elements": {
      "independent_variable": "ç›æ°´æµ“åº¦",
      "dependent_variable": "æ¤ç‰©ç”Ÿé•¿é«˜åº¦/å¥åº·çŠ¶å†µ",
      "control_variables": ["æ¤ç‰©ç§ç±»", "å…‰ç…§", "æ¸©åº¦", "åœŸå£¤"],
      "materials": ["æ¤ç‰©å¹¼è‹—", "ç›æ°´", "é‡æ¯", "å°ºå­", "è®°å½•è¡¨"]
    },
    "expected_outcome": "ç§‘å­¦æŠ¥å‘Š",
    "constraints": {
      "duration": "2å‘¨",
      "environment": "æ•™å®¤+å®¶åº­è§‚å¯Ÿ",
      "grade": "å°å­¦äº”å¹´çº§"
    },
    "implied_science_concept": "æ¸—é€å‹ã€æ¤ç‰©ç”Ÿç†å­¦"
  }
}
---
4. åå‘è¡¥å…¨çš„ä¾èµ–é“¾
å½“ä» experiment è¿›å…¥æ—¶ï¼Œç³»ç»Ÿéœ€è¦è¡¥å…¨å®Œæ•´çš„ä¾èµ–é“¾ï¼š
è¡¥å…¨é¡ºåº	Stage	ç”Ÿæˆä¾æ®	å…³é”®å¯¹é½ç‚¹
1	scenario	experiment_seed.implied_science_concept	æƒ…å¢ƒå¿…é¡»èƒ½è‡ªç„¶å¼•å‡ºè¯¥å®éªŒ
2	driving_question	scenario + experiment_seed.core_idea	é—®é¢˜å¿…é¡»æŒ‡å‘è¯¥å®éªŒè¦éªŒè¯çš„å†…å®¹
3	question_chain	driving_question + experiment_seed.experimental_elements	é—®é¢˜é“¾å¿…é¡»è¦†ç›–å®éªŒè®¾è®¡è¦ç´ 
4	activity	question_chain + experiment_seed.materials/constraints	æ´»åŠ¨å¿…é¡»åŒ…å«è¯¥å®éªŒçš„æ“ä½œæ­¥éª¤
5	experiment (éªŒè¯)	æ‰€æœ‰å‰ç½® + experiment_seed	éªŒè¯å®éªŒå¯è¡Œæ€§ï¼Œå¿…è¦æ—¶è°ƒæ•´
---
5. å®é™…äº¤äº’ç¤ºä¾‹
Step 1: ç”¨æˆ·è¾“å…¥å®éªŒæƒ³æ³•
è€å¤ªå¤ªï¼š "æˆ‘æƒ³è®©å­¦ç”Ÿåšä¸€ä¸ªå®éªŒï¼Œè§‚å¯Ÿç›æ°´å¯¹æ¤ç‰©çš„å½±å“ï¼Œè¦å†™æŠ¥å‘Š"
Step 2: ç³»ç»Ÿæå– Experiment Seed
ç³»ç»Ÿè‡ªåŠ¨è¯†åˆ«ï¼š
â€¢ æ ¸å¿ƒï¼šç›æ°´æµ“åº¦ vs æ¤ç‰©ç”Ÿé•¿
â€¢ äº§å‡ºï¼šç§‘å­¦æŠ¥å‘Š
â€¢ éšå«æ¦‚å¿µï¼šæ¸—é€å‹ã€æ¤ç‰©ç”Ÿç†
â€¢ ææ–™ï¼šæ¤ç‰©ã€ç›æ°´ã€æµ‹é‡å·¥å…·
Step 3: Decision Layer ç”Ÿæˆè§£é‡Š
ğŸ¤– "è¿™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ç§‘å­¦æ¢ç©¶å®éªŒï¼ä¸ºäº†ç¡®ä¿å­¦ç”Ÿèƒ½é¡ºåˆ©å®Œæˆå¹¶å†™å‡ºå¥½æŠ¥å‘Šï¼Œæˆ‘éœ€è¦å¸®æ‚¨è®¾è®¡å®Œæ•´çš„æ•™å­¦æµç¨‹ã€‚
æˆ‘æ³¨æ„åˆ°è¿™ä¸ªå®éªŒæ¶‰åŠ'æ¸—é€å‹'çš„ç§‘å­¦æ¦‚å¿µã€‚ä¸ºäº†è®©äº”å¹´çº§å­¦ç”Ÿç†è§£ï¼Œæˆ‘å»ºè®®ï¼š
1ï¸âƒ£ å…ˆè®¾è®¡ä¸€ä¸ªç”Ÿæ´»æƒ…å¢ƒï¼ˆæ¯”å¦‚'ä¸ºä»€ä¹ˆæµ·æ°´é‡Œçš„æ¤ç‰©å’Œæ·¡æ°´é‡Œä¸ä¸€æ ·ï¼Ÿ'ï¼‰
2ï¸âƒ£ ç„¶åæå‡ºé©±åŠ¨é—®é¢˜ï¼ˆæ¯”å¦‚'ç›ä¼šå½±å“æ¤ç‰©å–æ°´å—ï¼Ÿ'ï¼‰
3ï¸âƒ£ å†è®¾è®¡æ¢ç©¶é—®é¢˜é“¾ï¼ˆå¦‚ä½•è®¾è®¡å®éªŒã€æ€ä¹ˆæµ‹é‡ã€æ€ä¹ˆè®°å½•ï¼‰
4ï¸âƒ£ æœ€åç»†åŒ–æ‚¨çš„å®éªŒæ­¥éª¤ï¼Œç¡®ä¿å­¦ç”Ÿèƒ½æ“ä½œå¹¶ç”ŸæˆæŠ¥å‘Š
è¿™æ ·è®¾è®¡ï¼Œå­¦ç”Ÿä¸ä»…ä¼šåšå®éªŒï¼Œè¿˜èƒ½ç†è§£èƒŒåçš„ç§‘å­¦åŸç†ã€‚æˆ‘ä»¬ç°åœ¨å¼€å§‹ç¬¬ä¸€æ­¥ï¼Œè®¾è®¡æ•™å­¦æƒ…å¢ƒå—ï¼Ÿ"
Step 4: ç”Ÿæˆ Scenarioï¼ˆ3ä¸ªå€™é€‰ï¼‰
å€™é€‰	æƒ…å¢ƒ	å¯¹é½ç†ç”±
A	"æµ·è¾¹æ¤ç‰©è°ƒæŸ¥å‘˜"<br>å­¦ç”Ÿæ‰®æ¼”æ¤ç‰©å­¦å®¶ï¼Œè°ƒæŸ¥æµ·è¾¹å’Œå†…é™†æ¤ç‰©å·®å¼‚	ç›´æ¥å…³è”ç›æ°´ç¯å¢ƒï¼Œè‡ªç„¶å¼•å‡ºå®éªŒ
B	"å¨æˆ¿å°ç§‘å­¦å®¶"<br>ä»è…Œèœ/æ³¡å’¸èœçš„ç”Ÿæ´»ç°è±¡å…¥æ‰‹	è´´è¿‘ç”Ÿæ´»ï¼Œæ˜“ç†è§£æ¸—é€æ¦‚å¿µ
C	"æ¤ç‰©åŒ»é™¢"<br>å­¦ç”Ÿè¯Šæ–­"ç”Ÿç—…"çš„æ¤ç‰©ï¼ˆè¢«ç›æ°´ä¼¤å®³çš„ï¼‰	æƒ…æ„Ÿä»£å…¥å¼ºï¼Œé€‚åˆå†™æŠ¥å‘Š
è€å¤ªå¤ªé€‰æ‹©ï¼š "A å¥½ï¼Œæµ·è¾¹æ¤ç‰©æœ‰æ„æ€"
Step 5: ç”Ÿæˆ Driving Question
åŸºäº Scenario A + Experiment Seedï¼š
"æµ·è¾¹çš„æ¤ç‰©æ˜¯æ€ä¹ˆåœ¨å’¸æ°´é‡Œç”Ÿå­˜çš„ï¼Ÿæˆ‘ä»¬èƒ½ä¸èƒ½æ¨¡æ‹Ÿè¿™ä¸ªç¯å¢ƒï¼Œçœ‹çœ‹ç›å¯¹æ¤ç‰©æœ‰ä»€ä¹ˆå½±å“ï¼Ÿ"
Step 6: ç”Ÿæˆ Question Chain
1. è§‚å¯Ÿé—®é¢˜ï¼š æµ·è¾¹æ¤ç‰©å’Œå®¶é‡Œæ¤ç‰©æœ‰ä»€ä¹ˆä¸ä¸€æ ·ï¼Ÿ
2. è®¾è®¡é—®é¢˜ï¼š æ€ä¹ˆè®¾è®¡ä¸€ä¸ªå®éªŒæ¥æµ‹è¯•ç›å¯¹æ¤ç‰©çš„å½±å“ï¼Ÿï¼ˆå¯¹é½å®éªŒå˜é‡ï¼‰
3. æµ‹é‡é—®é¢˜ï¼š æˆ‘ä»¬éœ€è¦è®°å½•å“ªäº›æ•°æ®ï¼Ÿæ€ä¹ˆçŸ¥é“æ¤ç‰©"å¥½ä¸å¥½"ï¼Ÿï¼ˆå¯¹é½å®éªŒäº§å‡ºï¼‰
4. åˆ†æé—®é¢˜ï¼š å®éªŒç»“æœæ€ä¹ˆå†™æˆç§‘å­¦æŠ¥å‘Šï¼Ÿï¼ˆå¯¹é½ expected_outcomeï¼‰
Step 7: ç”Ÿæˆ Activityï¼ˆåŒ…å«å®éªŒï¼‰
è¿™é‡Œéœ€è¦ åŒé‡å¯¹é½ï¼š
â€¢ å¯¹é½ Question Chainï¼ˆæ¢ç©¶é€»è¾‘ï¼‰
â€¢ å¯¹é½ Experiment Seedï¼ˆå®éªŒå…·ä½“æ“ä½œï¼‰
{
  "activity": {
    "title": "æ¨¡æ‹Ÿæµ·æ°´ç¯å¢ƒå®éªŒ",
    "steps": [
      "å‡†å¤‡4ç»„æ¤ç‰©ï¼Œåˆ†åˆ«ç”¨0%ã€1%ã€3%ã€5%ç›æ°´æµ‡çŒ",
      "æ¯å¤©è§‚å¯Ÿè®°å½•æ¤ç‰©é«˜åº¦ã€å¶ç‰‡é¢œè‰²",
      "æŒç»­2å‘¨ï¼Œå¡«å†™è§‚å¯Ÿè®°å½•è¡¨",
      "æ•´ç†æ•°æ®ï¼Œæ’°å†™ç§‘å­¦æŠ¥å‘Š"
    ],
    "materials": ["æ¤ç‰©å¹¼è‹—", "ç›æ°´", "é‡æ¯", "å°ºå­", "è®°å½•è¡¨"],
    "output": "ç§‘å­¦æŠ¥å‘Šæ¨¡æ¿ + æ•°æ®åˆ†ææŒ‡å¯¼"
  },
  "alignment_check": {
    "matches_experiment_seed": true,
    "variables_aligned": true,
    "duration_fits": true,
    "report_requirement_met": true
  }
}
---
6. å…³é”®æœºåˆ¶ï¼šExperiment å¯è¡Œæ€§éªŒè¯
åœ¨è¡¥å…¨æ‰€æœ‰å‰ç½® Stage åï¼Œç³»ç»Ÿéœ€è¦éªŒè¯ï¼š
def validate_experiment_feasibility(experiment_seed, generated_chain):
    checks = {
        # 1. ç§‘å­¦æ¦‚å¿µæ˜¯å¦åŒ¹é…å¹´çº§
        "concept_grade_match": check_concept_difficulty(
            experiment_seed.implied_science_concept, 
            generated_chain.scenario.grade
        ),
        
        # 2. ææ–™æ˜¯å¦åœ¨çº¦æŸèŒƒå›´å†…
        "materials_available": all(
            m in generated_chain.activity.available_materials 
            for m in experiment_seed.materials
        ),
        
        # 3. å®éªŒæ—¶é•¿æ˜¯å¦åŒ¹é…è¯¾æ—¶å®‰æ’
        "duration_fit": experiment_seed.constraints.duration <= generated_chain.activity.total_duration,
        
        # 4. äº§å‡ºè¦æ±‚æ˜¯å¦è¢«æ»¡è¶³
        "output_requirement": generated_chain.activity.output_matches(experiment_seed.expected_outcome)
    }
    
    if not all(checks.values()):
        return {
            "feasible": False,
            "issues": checks,
            "suggestions": generate_adjustments(experiment_seed, generated_chain)
        }
å¦‚æœå‘ç°å†²çªï¼š
ğŸ¤– "æ‚¨è®¾è®¡çš„å®éªŒéœ€è¦2å‘¨æ—¶é—´è§‚å¯Ÿï¼Œä½†æˆ‘ä»¬ç›®å‰çš„æ´»åŠ¨å®‰æ’åªæœ‰3ä¸ªè¯¾æ—¶ã€‚æˆ‘æœ‰ä¸¤ä¸ªå»ºè®®ï¼š
A. è°ƒæ•´ä¸º'çŸ­æœŸè§‚å¯Ÿå®éªŒ'ï¼š ç”¨ç»¿è±†å‘èŠ½ï¼Œ3å¤©å°±èƒ½çœ‹åˆ°ç»“æœï¼Œç„¶åå†™ç®€çŸ­æŠ¥å‘Š
B. è°ƒæ•´ä¸º'é•¿æœŸé¡¹ç›®å¼å­¦ä¹ 'ï¼š å»¶ä¼¸åˆ°è¯¾åå®¶åº­è§‚å¯Ÿï¼Œè¯¾å ‚ä¸Šåšæ•°æ®æ±‡æ€»å’ŒæŠ¥å‘Šæ’°å†™
æ‚¨å€¾å‘å“ªç§æ–¹å¼ï¼Ÿ"
---
7. æ‰©å±•çš„ Entry Point é…ç½®
ENTRY_POINT_HANDLERS = {
    # ... å…¶ä»–å…¥å£ ...
    
    "experiment": {
        "dependencies": ["scenario", "driving_question", "question_chain", "activity"],
        "extract_experiment_seed": True,  # æå–å®éªŒè¦ç´ 
        "direction": "backward_full_chain",  # å¿…é¡»è¡¥å…¨æ•´ä¸ªé“¾
        "special_validation": "experiment_feasibility_check",  # é¢å¤–éªŒè¯
        "user_prompt_template": "experiment_entry_prompt"
    }
}
---
8. å¯¹è€å¤ªå¤ªç”¨æˆ·çš„å‹å¥½è®¾è®¡
å…³é”®åŸåˆ™ï¼š å¥¹åªéœ€è¦æè¿°"æƒ³åšä»€ä¹ˆå®éªŒ"ï¼Œç³»ç»Ÿå¤„ç†æ‰€æœ‰æŠ€æœ¯ç»†èŠ‚ã€‚
å¥¹è¯´	ç³»ç»Ÿç†è§£	ç³»ç»Ÿåš
"æˆ‘æƒ³åšä¸ªå®éªŒ"	entry_point = experiment	æå–å®éªŒè¦ç´ 
"è¦å‡†å¤‡ææ–™"	è®°å½• materials	åœ¨ activity ä¸­ä½“ç°
"è¦å†™æŠ¥å‘Š"	expected_outcome = report	åœ¨ question_chain ä¸­åŠ å…¥å†™ä½œæŒ‡å¯¼
"2å‘¨æ—¶é—´"	duration constraint	éªŒè¯å¹¶å»ºè®®è°ƒæ•´æ–¹æ¡ˆ
æ°¸è¿œä¸è¯´ï¼š "æ‚¨éœ€è¦ä» scenario å¼€å§‹è¡¥å…¨ä¾èµ–"
è€Œæ˜¯è¯´ï¼š "è¿™ä¸ªå®éªŒå¾ˆå¥½ï¼Œæˆ‘æ¥å¸®æ‚¨è®¾è®¡ä¸€ä¸ªå®Œæ•´çš„æ¢ç©¶è¯¾ç¨‹ï¼Œè®©å­¦ç”Ÿä¸ä»…ä¼šåšï¼Œè¿˜èƒ½ç†è§£åŸç†ã€‚æˆ‘ä»¬å…ˆä»è®¾è®¡ä¸€ä¸ªæœ‰è¶£çš„æƒ…å¢ƒå¼€å§‹ï¼Œå¥½å—ï¼Ÿ"
---
9. æ€»ç»“ï¼š004 æ¶æ„çš„çµæ´»æ€§
ä»»æ„èŠ‚ç‚¹è¿›å…¥ = ä»»æ„æ•™å­¦çµæ„Ÿèµ·ç‚¹

Scenario        â†’ æ­£å‘æ¨è¿›
Tool Seed       â†’ åå‘è¡¥å…¨ â†’ æ­£å‘æ¨è¿›  
Driving Question â†’ åå‘è¡¥å…¨(scenario) â†’ æ­£å‘æ¨è¿›
Question Chain  â†’ åå‘è¡¥å…¨(scenario+dq) â†’ æ­£å‘æ¨è¿›
Activity        â†’ åå‘è¡¥å…¨(å‰é¢å…¨éƒ¨) â†’ æ­£å‘æ¨è¿›
Experiment      â†’ åå‘è¡¥å…¨(æ•´ä¸ªé“¾) â†’ éªŒè¯å¯è¡Œæ€§ â†’ å¯¹é½äº§å‡º

æ ¸å¿ƒä¿è¯ï¼šæ— è®ºä»å“ªé‡Œå¼€å§‹ï¼Œæœ€ç»ˆéƒ½å¾—åˆ°ç»“æ„å®Œæ•´ã€é€»è¾‘è‡ªæ´½çš„è¯¾ç¨‹
è€å¤ªå¤ªå®Œå…¨å¯ä»¥ä»"ä¸€ä¸ªç»ä½³çš„å®éªŒæƒ³æ³•"å¼€å§‹ï¼Œç³»ç»Ÿä¼šå¸®å¥¹æ­å»ºå®Œæ•´çš„æ•™å­¦å¤§å¦ï¼ ğŸ—ï¸

ä¾‹å­3ï¼š
å½“ç„¶å¯ä»¥ï¼è¿™æ­£æ˜¯ 004 æ¶æ„ çš„å¼ºå¤§ä¹‹å¤„â€”â€”ä»»ä½•æ•™å­¦çµæ„Ÿéƒ½å¯ä»¥æˆä¸ºèµ·ç‚¹ã€‚è®©æˆ‘ä¸ºæ‚¨è¯¦ç»†å±•ç¤º"ä»é©±åŠ¨é—®é¢˜ï¼ˆDriving Questionï¼‰èµ·æ­¥"çš„å®Œæ•´æœºåˆ¶ï¼š
---
ä»é©±åŠ¨é—®é¢˜ï¼ˆDriving Questionï¼‰èµ·æ­¥çš„å®Œæ•´æµç¨‹
1. ç”¨æˆ·åœºæ™¯
è€å¤ªå¤ªï¼š "æˆ‘æƒ³è®©å­¦ç”Ÿæ€è€ƒä¸€ä¸ªé—®é¢˜ï¼šä¸ºä»€ä¹ˆåŒæ ·çš„ç§å­ï¼Œç§åœ¨ä¸åŒåœ°æ–¹é•¿å‡ºæ¥çš„æ¤ç‰©ä¸ä¸€æ ·é«˜ï¼Ÿ"
è¿™å°±æ˜¯å…¸å‹çš„ ä» Driving Question èŠ‚ç‚¹è¿›å…¥ï¼š
â€¢ æœ‰ä¸€ä¸ªæ ¸å¿ƒçš„ã€çœŸå®çš„ã€æœ‰æŒ‘æˆ˜æ€§çš„é—®é¢˜
â€¢ é—®é¢˜æœ¬èº«å…·æœ‰æ¢ç©¶ä»·å€¼
â€¢ ä½†ç¼ºå°‘æƒ…å¢ƒèƒŒæ™¯ã€æ¢ç©¶è·¯å¾„å’Œå…·ä½“æ´»åŠ¨
---
2. ç³»ç»Ÿå¤„ç†æµç¨‹
ç”¨æˆ·è¾“å…¥é©±åŠ¨é—®é¢˜
    â†“
[entry_node] è¯†åˆ« entry_point = "driving_question"
    â†“
[dependency_check_node] æ£€æŸ¥ä¾èµ–
    â†“
å‘ç°ç¼ºå¤±ï¼š["scenario"]  // åªæœ‰ scenario æ˜¯å¿…éœ€çš„
    â†“
è§¦å‘åå‘è¡¥å…¨ï¼šå…ˆç”Ÿæˆ scenario
    â†“
[scenario_generator] åŸºäº driving_question ç”Ÿæˆ 3 ä¸ªæƒ…å¢ƒ
    â†“
ç”¨æˆ·é€‰æ‹©æƒ…å¢ƒ
    â†“
æ­£å‘æ¨è¿›ï¼šquestion_chain â†’ activity â†’ experiment
    â†“
å…¨ç¨‹ä¿æŒä¸ driving_question çš„æ ¸å¿ƒå¯¹é½
---
3. Driving Question Seed å®šä¹‰
{
  "entry_point": "driving_question",
  "driving_question_seed": {
    "raw_question": "ä¸ºä»€ä¹ˆåŒæ ·çš„ç§å­ï¼Œç§åœ¨ä¸åŒåœ°æ–¹é•¿å‡ºæ¥çš„æ¤ç‰©ä¸ä¸€æ ·é«˜ï¼Ÿ",
    "parsed_elements": {
      "core_phenomenon": "æ¤ç‰©ç”Ÿé•¿å·®å¼‚",
      "variables_implied": ["åœŸå£¤", "å…‰ç…§", "æ°´åˆ†", "æ¸©åº¦"],
      "investigation_type": "å¯¹æ¯”å®éªŒ",
      "discipline": "ç”Ÿç‰©å­¦/ç¯å¢ƒç§‘å­¦",
      "grade_level": "å°å­¦ä¸­é«˜å¹´çº§"
    },
    "question_characteristics": {
      "is_open_ended": true,
      "has_real_world_connection": true,
      "allows_multiple_variables": true,
      "supports_experimentation": true
    },
    "implied_learning_goals": [
      "ç†è§£ç¯å¢ƒå› ç´ å¯¹ç”Ÿç‰©çš„å½±å“",
      "å­¦ä¹ æ§åˆ¶å˜é‡æ³•",
      "åŸ¹å…»è§‚å¯Ÿä¸è®°å½•èƒ½åŠ›"
    ]
  }
}
---
4. å…³é”®æœºåˆ¶ï¼šæƒ…å¢ƒä¸é—®é¢˜çš„åŒå‘é€‚é…
è¿™æ˜¯ 004 æ¶æ„ çš„ç²¾å¦™ä¹‹å¤„ï¼šä¸æ˜¯ç®€å•è¡¥å…¨ï¼Œè€Œæ˜¯æ·±åº¦å¯¹é½
Driving Question Seed
        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æå–é—®é¢˜ç‰¹å¾ï¼š                      â”‚
â”‚  â€¢ æ ¸å¿ƒç°è±¡ï¼šæ¤ç‰©ç”Ÿé•¿å·®å¼‚            â”‚
â”‚  â€¢ éšå«å˜é‡ï¼šåœŸå£¤ã€å…‰ç…§ã€æ°´åˆ†ã€æ¸©åº¦   â”‚
â”‚  â€¢ æ¢ç©¶æ–¹å¼ï¼šå¯¹æ¯”å®éªŒ                â”‚
â”‚  â€¢ å­¦ç§‘é¢†åŸŸï¼šç”Ÿç‰©/ç¯å¢ƒ               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†“
Scenario Generator æ¥æ”¶çº¦æŸæ¡ä»¶
        â†“
ç”Ÿæˆ 3 ä¸ªæƒ…å¢ƒï¼Œæ¯ä¸ªéƒ½å¿…é¡»ï¼š
âœ… èƒ½è‡ªç„¶å¼•å‡ºè¯¥é©±åŠ¨é—®é¢˜
âœ… åŒ…å«é—®é¢˜ä¸­æåˆ°çš„å˜é‡
âœ… é€‚åˆç›®æ ‡å¹´çº§å­¦ç”Ÿ
---
5. å®é™…äº¤äº’ç¤ºä¾‹
Step 1: ç”¨æˆ·è¾“å…¥é©±åŠ¨é—®é¢˜
è€å¤ªå¤ªï¼š "æˆ‘æƒ³è®©å­¦ç”Ÿæ€è€ƒï¼šä¸ºä»€ä¹ˆåŒæ ·çš„ç§å­ï¼Œç§åœ¨ä¸åŒåœ°æ–¹é•¿å‡ºæ¥çš„æ¤ç‰©ä¸ä¸€æ ·é«˜ï¼Ÿ"
Step 2: ç³»ç»Ÿè§£æé—®é¢˜ç‰¹å¾
ç³»ç»Ÿè‡ªåŠ¨æå–ï¼š
â€¢ æ ¸å¿ƒå†²çªï¼š ç›¸åŒç§å­ â†’ ä¸åŒç¯å¢ƒ â†’ ä¸åŒç»“æœ
â€¢ æ¢ç©¶è·¯å¾„ï¼š å¯¹æ¯”å®éªŒã€æ§åˆ¶å˜é‡
â€¢ æ½œåœ¨åœºæ™¯ï¼š å†œç”°ã€èŠ±å›­ã€é˜³å°ã€å±±å¡ç­‰ä¸åŒç¯å¢ƒ
Step 3: Decision Layer ç”Ÿæˆè§£é‡Š
ğŸ¤– "è¿™æ˜¯ä¸€ä¸ªéå¸¸å¥½çš„é©±åŠ¨é—®é¢˜ï¼å®ƒæ—¢è´´è¿‘ç”Ÿæ´»ï¼Œåˆèƒ½å¼•å¯¼å­¦ç”Ÿåšç§‘å­¦æ¢ç©¶ã€‚
ä¸ºäº†è®©è¿™ä¸ªé—®é¢˜æ›´æœ‰å¸å¼•åŠ›ï¼Œæˆ‘éœ€è¦ä¸ºæ‚¨è®¾è®¡ä¸€ä¸ªå…·ä½“çš„æ•™å­¦æƒ…å¢ƒâ€”â€”ä¸€ä¸ªè®©å­¦ç”ŸçœŸæ­£'æƒ³è¦'å»æ¢ç©¶è¿™ä¸ªé—®é¢˜çš„åœºæ™¯ã€‚
åŸºäºæ‚¨çš„é—®é¢˜ï¼Œæˆ‘æƒ³åˆ°ä¸‰ä¸ªä¸åŒçš„æƒ…å¢ƒï¼Œæ‚¨çœ‹çœ‹å“ªä¸ªæ›´é€‚åˆæ‚¨çš„å­¦ç”Ÿï¼š
Step 4: ç”Ÿæˆ Scenarioï¼ˆ3ä¸ªå€™é€‰ï¼Œéƒ½ä¸é—®é¢˜æ·±åº¦å¯¹é½ï¼‰
å€™é€‰	æƒ…å¢ƒ	ä¸ Driving Question çš„å¯¹é½
A	"å°å°å†œåœºä¸»"<br>å­¦ç”Ÿåœ¨æ•™å®¤é˜³å°å¼€è¾Ÿ"ç­çº§å†œåœº"ï¼Œå‘ç°åŒæ ·çš„ç§å­åœ¨ä¸åŒèŠ±ç›†é‡Œé•¿å¾—ä¸ä¸€æ ·	ç›´æ¥å¯¹åº”"ä¸åŒåœ°æ–¹"â†’ä¸åŒèŠ±ç›†ï¼›å­¦ç”Ÿæœ‰çœŸå®ç§æ¤ä½“éªŒ
B	"æ¤ç‰©ä¾¦æ¢ç¤¾"<br>å­¦æ ¡èŠ±å›­é‡Œçš„æ¤ç‰©æœ‰çš„èŒ‚ç››æœ‰çš„ç˜¦å¼±ï¼Œå­¦ç”Ÿè¦æ‰¾å‡º"å‡¶æ‰‹"	å°†é—®é¢˜åŒ…è£…æˆä¾¦æ¢æ•…äº‹ï¼›å¯¹æ¯”ä¸åŒä½ç½®çš„æ¤ç‰©
C	"å¤ªç©ºç§æ¤æŒ‘æˆ˜"<br>æ¨¡æ‹Ÿç«æ˜ŸåŸºåœ°ï¼Œå­¦ç”Ÿè¦æ‰¾å‡ºæœ€é€‚åˆç§æ¤åœŸè±†çš„ç¯å¢ƒ	ç§‘å¹»æƒ…å¢ƒï¼›å¼ºè°ƒç¯å¢ƒå˜é‡æ§åˆ¶ï¼›é«˜è¶£å‘³æ€§
ç³»ç»Ÿè§£é‡Šï¼š
ğŸ¤– "A æƒ…å¢ƒæœ€ç›´æ¥ï¼Œå­¦ç”Ÿèƒ½äº²æ‰‹ç§ï¼›B æƒ…å¢ƒåƒä¾¦æ¢æ¸¸æˆï¼Œé€‚åˆå–œæ¬¢æ¨ç†çš„å­¦ç”Ÿï¼›C æƒ…å¢ƒæ›´æœ‰è¶£ï¼Œä½†éœ€è¦æ›´å¤šå‡†å¤‡ã€‚æ‚¨å€¾å‘å“ªä¸ªï¼Ÿ"
è€å¤ªå¤ªé€‰æ‹©ï¼š "A å§ï¼Œæˆ‘æƒ³è®©ä»–ä»¬çœŸçš„ç§ç§å­"
Step 5: ç”Ÿæˆ Question Chainï¼ˆåŸºäº Driving Question å±•å¼€ï¼‰
åŸå§‹ Driving Questionï¼š"ä¸ºä»€ä¹ˆåŒæ ·çš„ç§å­ï¼Œç§åœ¨ä¸åŒåœ°æ–¹é•¿å‡ºæ¥çš„æ¤ç‰©ä¸ä¸€æ ·é«˜ï¼Ÿ"
å±•å¼€ä¸ºæ¢ç©¶é—®é¢˜é“¾ï¼š
1. è§‚å¯Ÿé—®é¢˜ï¼š æˆ‘ä»¬çš„ç­çº§å†œåœºé‡Œï¼Œå“ªäº›æ¤ç‰©é•¿å¾—å¥½ï¼Ÿå“ªäº›é•¿å¾—ä¸å¥½ï¼Ÿï¼ˆæè¿°ç°è±¡ï¼‰
2. åˆ†æé—®é¢˜ï¼š è¿™äº›æ¤ç‰©çš„ç”Ÿé•¿ç¯å¢ƒæœ‰ä»€ä¹ˆä¸åŒï¼Ÿï¼ˆè¯†åˆ«å˜é‡ï¼šåœŸå£¤ã€å…‰ç…§ã€æµ‡æ°´...ï¼‰
3. è®¾è®¡é—®é¢˜ï¼š æ€ä¹ˆè®¾è®¡ä¸€ä¸ªå…¬å¹³çš„å®éªŒæ¥æµ‹è¯•"åœŸå£¤"çš„å½±å“ï¼Ÿï¼ˆæ§åˆ¶å˜é‡æ³•ï¼‰
4. éªŒè¯é—®é¢˜ï¼š å¦‚æœæ”¹å˜åœŸå£¤ï¼Œæ¤ç‰©çœŸçš„ä¼šé•¿å¾—ä¸ä¸€æ ·å—ï¼Ÿï¼ˆæŒ‡å‘åŸé—®é¢˜çš„éªŒè¯ï¼‰
5. åº”ç”¨é—®é¢˜ï¼š æ ¹æ®æˆ‘ä»¬çš„å‘ç°ï¼Œæ€æ ·è®©å…¨ç­æ¤ç‰©éƒ½é•¿å¾—æ›´å¥½ï¼Ÿï¼ˆè¿ç§»åº”ç”¨ï¼‰
å¯¹é½æ£€æŸ¥ï¼š æ¯ä¸ªå­é—®é¢˜éƒ½æœåŠ¡äºå›ç­”æœ€åˆçš„ Driving Question
Step 6: ç”Ÿæˆ Activityï¼ˆåŒ…å«å¯¹æ¯”å®éªŒï¼‰
{
  "activity": {
    "title": "ç­çº§å†œåœºå¯¹æ¯”å®éªŒ",
    "alignment_with_driving_question": {
      "core_question": "ä¸ºä»€ä¹ˆåŒæ ·çš„ç§å­ï¼Œç§åœ¨ä¸åŒåœ°æ–¹é•¿å‡ºæ¥çš„æ¤ç‰©ä¸ä¸€æ ·é«˜ï¼Ÿ",
      "activity_goal": "é€šè¿‡æ§åˆ¶å˜é‡å®éªŒï¼ŒéªŒè¯ç¯å¢ƒå› ç´ çš„å½±å“"
    },
    "steps": [
      {
        "step": 1,
        "action": "åœ¨æ•™å®¤ä¸åŒä½ç½®è®¾ç½®å®éªŒç‚¹ï¼ˆçª—å°/è§’è½/é—¨å£ï¼‰",
        "addresses_variable": "å…‰ç…§"
      },
      {
        "step": 2,
        "action": "ä½¿ç”¨ç›¸åŒç§å­ï¼Œä½†ä¸åŒåœŸå£¤ï¼ˆå›­åœŸ/æ²™åœŸ/è¥å…»åœŸï¼‰",
        "addresses_variable": "åœŸå£¤"
      },
      {
        "step": 3,
        "action": "ç»Ÿä¸€æµ‡æ°´ï¼Œæ¯å¤©è§‚å¯Ÿè®°å½•é«˜åº¦",
        "addresses_variable": "æ§åˆ¶æ°´åˆ†å˜é‡"
      },
      {
        "step": 4,
        "action": "2å‘¨åå¯¹æ¯”æ•°æ®ï¼Œè®¨è®ºç»“æœ",
        "synthesizes_answer": "å›ç­” driving_question"
      }
    ],
    "expected_output": "å®éªŒæŠ¥å‘Š + ç­çº§å†œåœºä¼˜åŒ–æ–¹æ¡ˆ"
  }
}
---
6. å…³é”®ä¼˜åŠ¿ï¼šé—®é¢˜é©±åŠ¨çš„ä¸€è‡´æ€§
ä¼ ç»Ÿæ–¹å¼	004 æ¶æ„æ–¹å¼
å…ˆæƒ³æƒ…å¢ƒ â†’ å†ç¼–é—®é¢˜ï¼ˆå¯èƒ½ä¸åŒ¹é…ï¼‰	ä»çœŸå®é—®é¢˜å‡ºå‘ â†’ æƒ…å¢ƒæœåŠ¡äºé—®é¢˜
é—®é¢˜å¯èƒ½è¢«æƒ…å¢ƒé™åˆ¶	æƒ…å¢ƒå¿…é¡»èƒ½è‡ªç„¶å¼•å‡ºè¯¥é—®é¢˜
å®¹æ˜“å˜æˆ"ä¸ºäº†æ´»åŠ¨è€Œæ´»åŠ¨"	æ‰€æœ‰æ´»åŠ¨éƒ½æŒ‡å‘å›ç­”æ ¸å¿ƒé—®é¢˜
è€å¤ªå¤ªçš„ä½“éªŒï¼š å¥¹åªéœ€è¦æƒ³ä¸€ä¸ªå¥½é—®é¢˜ï¼Œç³»ç»Ÿå¸®å¥¹æ­å»ºå®Œæ•´çš„æ¢ç©¶è·¯å¾„ï¼Œç¡®ä¿"è¿™ä¸ªé—®é¢˜çœŸçš„èƒ½æ¢ç©¶ï¼Œè€Œä¸”èƒ½æ¢ç©¶å‡ºç»“æœ"ã€‚
---
7. æ‰©å±•çš„ Entry Point é…ç½®
ENTRY_POINT_HANDLERS = {
    # ... å…¶ä»–å…¥å£ ...
    
    "driving_question": {
        "dependencies": ["scenario"],  # åªéœ€è¦è¡¥å…¨ scenario
        "direction": "backward_then_forward",
        "backward_depth": 1,  # åªåå‘è¡¥å…¨1å±‚
        "special_processing": "question_parsing",  # è§£æé—®é¢˜ç‰¹å¾
        "constraints": {
            "scenario_must_introduce_question": True,  # æƒ…å¢ƒå¿…é¡»èƒ½å¼•å‡ºè¯¥é—®é¢˜
            "question_chain_must_address_core_question": True  # é—®é¢˜é“¾å¿…é¡»å›åº”æ ¸å¿ƒé—®é¢˜
        }
    }
}
---
8. å¯¹è€å¤ªå¤ªçš„å‹å¥½è®¾è®¡
å¥¹è¯´ï¼š "æˆ‘æƒ³è®©å­¦ç”Ÿæ€è€ƒä¸€ä¸ªé—®é¢˜..."
ç³»ç»Ÿç†è§£ï¼š
â€¢ å¥¹æœ‰ä¸€ä¸ªå¥½é—®é¢˜ï¼ˆDriving Questionï¼‰
â€¢ å¥¹éœ€è¦æƒ…å¢ƒè®©é—®é¢˜æ›´ç”ŸåŠ¨
â€¢ å¥¹éœ€è¦æ¢ç©¶è·¯å¾„è®©å­¦ç”Ÿèƒ½å›ç­”è¿™ä¸ªé—®é¢˜
ç³»ç»Ÿä¸è¯´ï¼š "æ‚¨éœ€è¦å…ˆè®¾è®¡æ•™å­¦æƒ…å¢ƒ"
ç³»ç»Ÿè¯´ï¼š "è¿™ä¸ªé—®é¢˜å¾ˆæ£’ï¼è®©æˆ‘å¸®æ‚¨è®¾è®¡ä¸€ä¸ªæƒ…å¢ƒï¼Œè®©å­¦ç”ŸçœŸçš„æƒ³è¦å»æ¢ç©¶è¿™ä¸ªé—®é¢˜ã€‚æ‚¨çœ‹'å°å°å†œåœºä¸»'æ€ä¹ˆæ ·ï¼Ÿ"
---
9. å¯¹æ¯”ï¼šä¸åŒèµ·ç‚¹çš„è¡¥å…¨æ·±åº¦
èµ·ç‚¹	éœ€è¦åå‘è¡¥å…¨	è¡¥å…¨å¤æ‚åº¦	å…³é”®å¯¹é½ç‚¹
Scenario	æ— 	â­	ç›´æ¥æ­£å‘æ¨è¿›
Tool Seed	scenario	â­â­	å·¥å…·ç‰¹æ€§â†’æƒ…å¢ƒé€‚é…
Driving Question	scenario	â­â­	é—®é¢˜ç‰¹å¾â†’æƒ…å¢ƒå¼•å‡º
Question Chain	scenario + dq	â­â­â­	é—®é¢˜é€»è¾‘â†’æƒ…å¢ƒ+æ ¸å¿ƒé—®é¢˜
Activity	å‰é¢å…¨éƒ¨	â­â­â­â­	æ´»åŠ¨è¦ç´ â†’å®Œæ•´é“¾
Experiment	å‰é¢å…¨éƒ¨	â­â­â­â­â­	å®éªŒå¯è¡Œæ€§â†’å…¨é“¾éªŒè¯
Driving Question çš„ä¼˜åŠ¿ï¼š åªéœ€è¦è¡¥å…¨1å±‚ï¼ˆscenarioï¼‰ï¼Œæ˜¯æ•ˆç‡æœ€é«˜çš„åå‘è¡¥å…¨è·¯å¾„ä¹‹ä¸€ã€‚
---
10. æ€»ç»“
è€å¤ªå¤ªçš„ä»»æ„çµæ„Ÿèµ·ç‚¹ï¼š

ğŸ’¡ "æˆ‘æƒ³ç”¨ Orange åš KNN" 
   â†’ Tool Seed â†’ åå‘è¡¥å…¨ â†’ å®Œæ•´è¯¾ç¨‹

ğŸ’¡ "æˆ‘æƒ³åšä¸ªç›æ°´æ¤ç‰©å®éªŒ" 
   â†’ Experiment Seed â†’ åå‘è¡¥å…¨å…¨é“¾ â†’ éªŒè¯å¯è¡Œæ€§

ğŸ’¡ "ä¸ºä»€ä¹ˆç§å­åœ¨ä¸åŒåœ°æ–¹é•¿å¾—ä¸ä¸€æ ·ï¼Ÿ" 
   â†’ Driving Question Seed â†’ è¡¥å…¨æƒ…å¢ƒ â†’ æ­£å‘æ¨è¿›

æ ¸å¿ƒæ‰¿è¯ºï¼š
âœ… ä»»æ„èµ·ç‚¹éƒ½èƒ½å»ºæˆå®Œæ•´è¯¾ç¨‹
âœ… æ‰€æœ‰ç¯èŠ‚è‡ªåŠ¨å¯¹é½åŸå§‹çµæ„Ÿ
âœ… ç”¨æˆ·å§‹ç»ˆåªæ„ŸçŸ¥"å¯¹è¯"ï¼Œä¸æ„ŸçŸ¥"æ¶æ„"
æ‰€ä»¥ï¼Œæ˜¯çš„â€”â€”æƒ³åˆ°ä¸€ä¸ªç»ä½³çš„é©±åŠ¨é—®é¢˜ï¼Œå®Œå…¨å¯ä»¥ä½œä¸ºèµ·ç‚¹ï¼ ğŸ¯

ä¾‹å­4ï¼š
å®Œå…¨å¯ä»¥ï¼è¿™æ­£æ˜¯ 004 æ¶æ„ è®¾è®¡çš„æ ¸å¿ƒåœºæ™¯ä¹‹ä¸€ã€‚è®©æˆ‘ä¸ºæ‚¨è¯¦ç»†è¯´æ˜"å•èŠ‚ç‚¹æ·±åº¦æ¢ç´¢"çš„å®Œæ•´æœºåˆ¶ï¼š
---
å•èŠ‚ç‚¹æ·±åº¦æ¢ç´¢æœºåˆ¶
1. ç”¨æˆ·åœºæ™¯
è€å¤ªå¤ªï¼š "æˆ‘è§‰å¾—è¿™ä¸ªé©±åŠ¨é—®é¢˜è¿˜ä¸å¤Ÿå¥½..."
ç³»ç»Ÿï¼š "æ‚¨å¸Œæœ›æ€ä¹ˆè°ƒæ•´ï¼Ÿ"
è€å¤ªå¤ªï¼š "èƒ½ä¸èƒ½æ›´è´´è¿‘ç”Ÿæ´»ä¸€ç‚¹ï¼Ÿ"
ç³»ç»Ÿï¼š "å¥½çš„ï¼Œç»™æ‚¨3ä¸ªæ›´ç”Ÿæ´»åŒ–çš„ç‰ˆæœ¬..."
è€å¤ªå¤ªï¼š "ç¬¬äºŒä¸ªä¸é”™ï¼Œä½†èƒ½ä¸èƒ½åŠ ä¸Šç¯ä¿çš„è§’åº¦ï¼Ÿ"
ç³»ç»Ÿï¼š "æ˜ç™½ï¼ŒåŸºäºç¯ä¿è§’åº¦é‡æ–°ç”Ÿæˆ..."
è€å¤ªå¤ªï¼š "ç­‰ç­‰ï¼Œæˆ‘è¿˜æ˜¯è§‰å¾—ç¬¬ä¸€ä¸ªå¥½ï¼Œä½†è¦æŠŠ'æ¤ç‰©'æ”¹æˆ'è”¬èœ'..."
è¿™å°±æ˜¯å…¸å‹çš„ å•èŠ‚ç‚¹å¾ªç¯ä¼˜åŒ– â€”â€”ç”¨æˆ·åœ¨ driving_question èŠ‚ç‚¹åå¤æ¢ç´¢ï¼Œç›´åˆ°æ»¡æ„ã€‚
---
2. æ¶æ„æ”¯æŒï¼šèŠ‚ç‚¹çš„"å¾®å¾ªç¯"
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å•èŠ‚ç‚¹å¾®å¾ªç¯                        â”‚
â”‚  ï¼ˆç”¨æˆ·ä¸æ„ŸçŸ¥ï¼Œç³»ç»Ÿå†…éƒ¨ç®¡ç†ï¼‰                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                     â”‚
â”‚   [å€™é€‰ç”Ÿæˆ] â”€â”€â–º [ç”¨æˆ·é€‰æ‹©/åé¦ˆ] â”€â”€â–º [å†³ç­–ç‚¹]         â”‚
â”‚        â–²                              â”‚            â”‚
â”‚        â”‚                              â–¼            â”‚
â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ [é‡æ–°ç”Ÿæˆ] â—„â”€â”˜            â”‚
â”‚                                                     â”‚
â”‚   å¾ªç¯æ¡ä»¶ï¼š                                          â”‚
â”‚   â€¢ ç”¨æˆ·è¦æ±‚"å†ç”Ÿæˆ"                                  â”‚
â”‚   â€¢ ç”¨æˆ·æä¾›ä¿®æ”¹æ„è§                                  â”‚
â”‚   â€¢ ç”¨æˆ·é€‰æ‹©"éƒ½ä¸æ»¡æ„"                                â”‚
â”‚                                                     â”‚
â”‚   é€€å‡ºæ¡ä»¶ï¼š                                          â”‚
â”‚   â€¢ ç”¨æˆ·ç¡®è®¤"æ»¡æ„"                                    â”‚
â”‚   â€¢ ç”¨æˆ·ä¸»åŠ¨è¯´"ä¸‹ä¸€æ­¥"                                â”‚
â”‚   â€¢ è¾¾åˆ°æœ€å¤§å¾ªç¯æ¬¡æ•°ï¼ˆå¦‚5æ¬¡ï¼‰                          â”‚
â”‚                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†“
   ç¡®è®¤åè¿›å…¥ä¸‹ä¸€é˜¶æ®µ
---
3. å…³é”®è®¾è®¡ï¼šèŠ‚ç‚¹çŠ¶æ€æœº
æ¯ä¸ª Stage æœ‰è‡ªå·±çš„çŠ¶æ€æµè½¬ï¼š
STAGE_STATES = {
    "driving_question": {
        # çŠ¶æ€å®šä¹‰
        "states": [
            "initialized",      # åˆšè¿›å…¥èŠ‚ç‚¹
            "generating",       # æ­£åœ¨ç”Ÿæˆå€™é€‰
            "pending_choice",   # ç­‰å¾…ç”¨æˆ·é€‰æ‹©
            "feedback_loop",    # ç”¨æˆ·åé¦ˆä¸­ï¼ˆå¾®å¾ªç¯ï¼‰
            "modifying",        # åŸºäºåé¦ˆä¿®æ”¹
            "finalized"         # ç¡®è®¤å®Œæˆ
        ],
        
        # å…è®¸çš„æ“ä½œ
        "allowed_actions": {
            "initialized": ["generate_candidates"],
            "pending_choice": ["select_candidate", "request_modify", "regenerate"],
            "feedback_loop": ["provide_feedback", "regenerate", "finalize"],
            "modifying": ["generate_candidates"],
            "finalized": ["proceed_next"]
        },
        
        # è½¬æ¢è§„åˆ™
        "transitions": {
            ("pending_choice", "request_modify"): "feedback_loop",
            ("feedback_loop", "regenerate"): "modifying",
            ("feedback_loop", "finalize"): "finalized",
            ("modifying", "generate_candidates"): "pending_choice"
        }
    }
}
---
4. å®é™…äº¤äº’ç¤ºä¾‹ï¼šDriving Question çš„æ·±åº¦æ¢ç´¢
åˆå§‹è¿›å…¥
è€å¤ªå¤ªï¼š "æˆ‘æƒ³ä»é©±åŠ¨é—®é¢˜å¼€å§‹"
ç³»ç»Ÿï¼š
ğŸ¤– "å¥½çš„ï¼è¯·å‘Šè¯‰æˆ‘æ‚¨æƒ³è®©å­¦ç”Ÿæ¢ç©¶ä»€ä¹ˆæ ¸å¿ƒé—®é¢˜ï¼Ÿæˆ–è€…æ‚¨æœ‰ä¸€ä¸ªåˆæ­¥æƒ³æ³•ï¼Œæˆ‘å¯ä»¥å¸®æ‚¨æ‰“ç£¨ï¼Ÿ"
è€å¤ªå¤ªï¼š "æˆ‘æƒ³é—®ï¼šæ¤ç‰©æ˜¯æ€ä¹ˆå–æ°´çš„ï¼Ÿ"
---
ç¬¬ä¸€è½®ç”Ÿæˆ
ç³»ç»Ÿï¼š ï¼ˆç”Ÿæˆ3ä¸ªå€™é€‰ï¼‰
å€™é€‰	é©±åŠ¨é—®é¢˜	ç‰¹ç‚¹
A	"æ¤ç‰©æ˜¯æ€ä¹ˆå–æ°´çš„ï¼Ÿ"	ç›´æ¥ç‰ˆï¼Œè´´è¿‘åŸå§‹æƒ³æ³•
B	"å¦‚æœæŠŠèŠ¹èœæ”¾è¿›çº¢å¢¨æ°´é‡Œï¼Œå®ƒçš„å¶å­ä¼šå˜çº¢å—ï¼Ÿ"	å®éªŒå¯¼å‘ï¼Œå¯éªŒè¯
C	"ä¸ºä»€ä¹ˆæ²™æ¼ é‡Œçš„æ¤ç‰©èƒ½åœ¨å¾ˆå°‘æ°´çš„æƒ…å†µä¸‹ç”Ÿå­˜ï¼Ÿ"	æ‹“å±•æ€ç»´ï¼Œè”ç³»ç¯å¢ƒ
ç³»ç»Ÿï¼š
ğŸ¤– "æˆ‘åŸºäºæ‚¨çš„é—®é¢˜ï¼Œè®¾è®¡äº†3ä¸ªä¸åŒè§’åº¦çš„é©±åŠ¨é—®é¢˜ï¼š
â€¢ A æ˜¯ç›´ç™½çš„é—®æ³•ï¼Œé€‚åˆç›´æ¥æ¢ç©¶
â€¢ B å¼•å¯¼å…·ä½“å®éªŒï¼Œå­¦ç”Ÿèƒ½åŠ¨æ‰‹éªŒè¯
â€¢ C è”ç³»çœŸå®ç¯å¢ƒï¼Œæ›´æœ‰æŒ‘æˆ˜æ€§
æ‚¨å–œæ¬¢å“ªä¸ªï¼Ÿæˆ–è€…å‘Šè¯‰æˆ‘æ€ä¹ˆè°ƒæ•´ï¼Ÿ"
---
ç¬¬ä¸€è½®åé¦ˆï¼šä¸æ»¡æ„
è€å¤ªå¤ªï¼š "æˆ‘è§‰å¾—éƒ½å¤ªç®€å•äº†ï¼Œèƒ½ä¸èƒ½æ›´å¼€æ”¾ä¸€ç‚¹ï¼Ÿ"
ç³»ç»Ÿï¼š ï¼ˆè®°å½•åé¦ˆï¼Œè§¦å‘é‡æ–°ç”Ÿæˆï¼‰
ğŸ¤– "æ˜ç™½ï¼Œæ‚¨å¸Œæœ›é—®é¢˜æ›´å¼€æ”¾ï¼Œè®©å­¦ç”Ÿæœ‰æ›´å¤šæ¢ç´¢ç©ºé—´ã€‚æˆ‘å†ç»™æ‚¨3ä¸ªç‰ˆæœ¬ï¼š"
å€™é€‰	é©±åŠ¨é—®é¢˜	æ”¹è¿›ç‚¹
A2	"æ¤ç‰©'å–æ°´'çš„æ–¹å¼å’Œäººç±»ä¸€æ ·å—ï¼Ÿ"	å¯¹æ¯”è§†è§’ï¼Œå¼€æ”¾æ¯”è¾ƒ
B2	"è®¾è®¡ä¸€ä¸ªå®éªŒï¼Œè¯æ˜æ¤ç‰©ç¡®å®åœ¨'å–æ°´'"	ä»»åŠ¡å¯¼å‘ï¼Œå¼€æ”¾è®¾è®¡
C2	"å¦‚æœæ²¡æœ‰æ ¹ï¼Œæ¤ç‰©è¿˜èƒ½è·å–æ°´åˆ†å—ï¼Ÿ"	åäº‹å®æ€è€ƒï¼Œå¼€æ”¾æ¢ç©¶
è€å¤ªå¤ªï¼š "B2 ä¸é”™ï¼Œä½†èƒ½ä¸èƒ½å’Œç¯ä¿ç»“åˆèµ·æ¥ï¼Ÿ"
---
ç¬¬äºŒè½®åé¦ˆï¼šå®šå‘ä¿®æ”¹
ç³»ç»Ÿï¼š ï¼ˆè®°å½•çº¦æŸï¼šå®éªŒè®¾è®¡ + ç¯ä¿ä¸»é¢˜ï¼‰
ğŸ¤– "å¥½çš„ï¼Œç»“åˆå®éªŒè®¾è®¡å’Œç¯ä¿ä¸»é¢˜ï¼š"
å€™é€‰	é©±åŠ¨é—®é¢˜	æ–°å¢çº¦æŸ
B2-1	"è®¾è®¡ä¸€ä¸ªå®éªŒï¼Œæ¯”è¾ƒä¸åŒæµ‡æ°´æ–¹å¼ä¸‹æ¤ç‰©çš„ç”Ÿé•¿ï¼Œæ‰¾å‡ºæœ€èŠ‚æ°´çš„ç§æ¤æ–¹æ³•"	å®éªŒ+èŠ‚æ°´ç¯ä¿
B2-2	"å­¦æ ¡èŠ±å›­è¦æ”¹é€ ï¼Œä½ èƒ½é€šè¿‡å®éªŒæ‰¾å‡ºæœ€é€‚åˆå¹²æ—±åœ°åŒºæ¤ç‰©çš„æµ‡æ°´æ–¹æ¡ˆå—ï¼Ÿ"	çœŸå®æƒ…å¢ƒ+ç¯ä¿
B2-3	"å¦‚ä½•é€šè¿‡å®éªŒï¼Œè¯æ˜'å°‘æµ‡æ°´ä¹Ÿèƒ½å…»å¥½æ¤ç‰©'ï¼Ÿ"	æŒ‘æˆ˜å¸¸è§„è®¤çŸ¥+ç¯ä¿
è€å¤ªå¤ªï¼š "B2-2 å¾ˆå¥½ï¼ä½†æˆ‘æƒ³è¦æ›´ç®€å•çš„ï¼Œé€‚åˆäºŒå¹´çº§"
---
ç¬¬ä¸‰è½®åé¦ˆï¼šè°ƒæ•´å¤æ‚åº¦
ç³»ç»Ÿï¼š ï¼ˆè®°å½•çº¦æŸï¼šå®éªŒè®¾è®¡ + ç¯ä¿ + äºŒå¹´çº§ç®€åŒ–ï¼‰
ğŸ¤– "æ˜ç™½ï¼ŒäºŒå¹´çº§ç‰ˆæœ¬ï¼Œæ›´ç®€å•ï¼š"
å€™é€‰	é©±åŠ¨é—®é¢˜	ç®€åŒ–ç­–ç•¥
B3-1	"æ€æ ·ç»™æ¤ç‰©å–æ°´æœ€çœæ°´ï¼Ÿæˆ‘ä»¬æ¥æ¯”ä¸€æ¯”ï¼"	å£è¯­åŒ–ï¼Œç›´æ¥æ¯”è¾ƒ
B3-2	"å°æ°´æ»´æ—…è¡Œè®°ï¼šæ¤ç‰©å–æ°´éœ€è¦å¤šå°‘æ°´ï¼Ÿ"	æ•…äº‹åŒ–ï¼Œé‡åŒ–è§‚å¯Ÿ
B3-3	"å¸®æ¤ç‰©æ‰¾'é¥®æ–™'ï¼šæ°´ã€ç‰›å¥¶ã€è¿˜æ˜¯æœæ±ï¼Ÿ"	è¶£å‘³æ€§ï¼Œç®€å•å¯¹æ¯”
è€å¤ªå¤ªï¼š "B3-1 å®Œç¾ï¼å°±è¿™ä¸ªï¼"
---
ç¡®è®¤å®Œæˆ
ç³»ç»Ÿï¼š ï¼ˆçŠ¶æ€å˜ä¸º finalizedï¼Œè®°å½•å®Œæ•´å†å²ï¼‰
ğŸ¤– "å¤ªå¥½äº†ï¼ç¡®å®šé©±åŠ¨é—®é¢˜ï¼š'æ€æ ·ç»™æ¤ç‰©å–æ°´æœ€çœæ°´ï¼Ÿæˆ‘ä»¬æ¥æ¯”ä¸€æ¯”ï¼'
æ¥ä¸‹æ¥ï¼Œæˆ‘ä¸ºæ‚¨è®¾è®¡æ•™å­¦æƒ…å¢ƒï¼Œè®©è¿™ä¸ªé—®é¢˜æ›´å¸å¼•äºŒå¹´çº§å­¦ç”Ÿï¼Œå¥½å—ï¼Ÿ"
è€å¤ªå¤ªï¼š "å¥½çš„"
ç³»ç»Ÿï¼š ï¼ˆè¿›å…¥ scenario èŠ‚ç‚¹ï¼Œæ­£å‘æ¨è¿›ï¼‰
---
5. ç³»ç»Ÿå†…éƒ¨çš„æ•°æ®è®°å½•
{
  "stage": "driving_question",
  "state": "finalized",
  "history": [
    {
      "round": 1,
      "user_input": "æ¤ç‰©æ˜¯æ€ä¹ˆå–æ°´çš„ï¼Ÿ",
      "candidates_generated": 3,
      "user_action": "feedback",
      "feedback": "å¤ªç®€å•äº†ï¼Œè¦æ›´å¼€æ”¾"
    },
    {
      "round": 2,
      "candidates_generated": 3,
      "user_action": "feedback",
      "selected_direction": "B2",
      "feedback": "è¦å’Œç¯ä¿ç»“åˆ"
    },
    {
      "round": 3,
      "candidates_generated": 3,
      "user_action": "feedback",
      "selected_direction": "B2-2",
      "feedback": "è¦æ›´ç®€å•ï¼Œé€‚åˆäºŒå¹´çº§"
    },
    {
      "round": 4,
      "candidates_generated": 3,
      "user_action": "select",
      "selected": "B3-1",
      "final_question": "æ€æ ·ç»™æ¤ç‰©å–æ°´æœ€çœæ°´ï¼Ÿæˆ‘ä»¬æ¥æ¯”ä¸€æ¯”ï¼"
    }
  ],
  "accumulated_constraints": [
    "å®éªŒè®¾è®¡å¯¼å‘",
    "ç¯ä¿ä¸»é¢˜ï¼ˆèŠ‚æ°´ï¼‰",
    "äºŒå¹´çº§è®¤çŸ¥æ°´å¹³",
    "å£è¯­åŒ–è¡¨è¾¾"
  ],
  "final_output": {
    "question": "æ€æ ·ç»™æ¤ç‰©å–æ°´æœ€çœæ°´ï¼Ÿæˆ‘ä»¬æ¥æ¯”ä¸€æ¯”ï¼",
    "implied_elements": {
      "investigation_type": "å¯¹æ¯”å®éªŒ",
      "variables": ["æµ‡æ°´é‡", "æ¤ç‰©ç”Ÿé•¿"],
      "core_concept": "æ¤ç‰©éœ€æ°´é‡/èŠ‚æ°´æ„è¯†"
    }
  }
}
---
6. LangGraph å¦‚ä½•å¤„ç†"å¾®å¾ªç¯"
ä¼ ç»Ÿ Graph è§†è§’ï¼ˆé”™è¯¯ï¼‰ï¼š
[scenario] â†’ [driving_question] â†’ [question_chain]
                  â†‘
                  â””â”€â”€ ç”¨æˆ·ä¸æ»¡æ„ï¼Œå›é€€ï¼Ÿ

004 æ¶æ„è§†è§’ï¼ˆæ­£ç¡®ï¼‰ï¼š
[scenario] â†’ [driving_question:å¾®å¾ªç¯] â†’ [question_chain]
                  â†“
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ å†…éƒ¨çŠ¶æ€æœº   â”‚
            â”‚ â€¢ generating â”‚
            â”‚ â€¢ pending   â”‚
            â”‚ â€¢ feedback  â”‚
            â”‚ â€¢ finalized â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â†“
            ç¡®è®¤åæ‰æ¨è¿›

å…³é”®ï¼šå¾®å¾ªç¯åœ¨èŠ‚ç‚¹å†…éƒ¨å®Œæˆï¼Œä¸è§¦å‘ Graph è·³è½¬
Graph èŠ‚ç‚¹è®¾è®¡ï¼š
def driving_question_node(state):
    # æ£€æŸ¥å½“å‰ Stage çŠ¶æ€
    current_status = state.stage_states["driving_question"]
    
    if current_status == "initialized":
        # é¦–æ¬¡è¿›å…¥ï¼Œç”Ÿæˆå€™é€‰
        return {"action": "generate_candidates", "count": 3}
    
    elif current_status == "pending_choice":
        # ç­‰å¾…ç”¨æˆ·æ“ä½œï¼ŒGraph æš‚åœ
        return {"action": "wait_for_user"}
    
    elif current_status == "feedback_loop":
        # ç”¨æˆ·æä¾›äº†åé¦ˆï¼Œå‡†å¤‡é‡æ–°ç”Ÿæˆ
        return {"action": "apply_feedback_and_regenerate"}
    
    elif current_status == "finalized":
        # ç¡®è®¤å®Œæˆï¼Œå¯ä»¥æ¨è¿›åˆ°ä¸‹ä¸€èŠ‚ç‚¹
        return {"action": "proceed_to_next_stage", "next": "question_chain"}
    
    # å…¶ä»–çŠ¶æ€...
---
7. å¯¹è€å¤ªå¤ªçš„å‹å¥½è®¾è®¡
å¥¹è¯´	ç³»ç»Ÿç†è§£	ç³»ç»Ÿåš
"å†ç»™æˆ‘å‡ ä¸ª"	regenerate	åŸºäºå½“å‰çº¦æŸé‡æ–°ç”Ÿæˆ
"è¿™ä¸ªä¸é”™ï¼Œä½†..."	feedback + modify	è®°å½•åé¦ˆï¼Œå®šå‘è°ƒæ•´
"å¤ªå¤æ‚äº†"	simplify constraint	é™ä½è®¤çŸ¥å¤æ‚åº¦
"èƒ½ä¸èƒ½ç»“åˆ..."	add theme constraint	è¿½åŠ ä¸»é¢˜çº¦æŸ
"æˆ‘è¿˜æ˜¯å–œæ¬¢ç¬¬ä¸€ä¸ª"	rollback	å›åˆ°ä¹‹å‰ç‰ˆæœ¬
"å°±è¿™ä¸ªäº†ï¼"	finalize	ç¡®è®¤ï¼Œå‡†å¤‡ä¸‹ä¸€æ­¥
å…³é”®ï¼šç³»ç»Ÿè®°ä½æ‰€æœ‰ä¸Šä¸‹æ–‡ï¼Œä¸ä¼š"å¿˜è®°"ä¹‹å‰çš„è®¨è®º
---
8. è¾¹ç•Œä¿æŠ¤ï¼šé˜²æ­¢æ— é™å¾ªç¯
MAX_ITERATIONS = 5  # æœ€å¤§å¾®å¾ªç¯æ¬¡æ•°

def check_exit_conditions(stage_state, user_input):
    # å¼ºåˆ¶é€€å‡ºæ¡ä»¶
    if stage_state.iteration_count >= MAX_ITERATIONS:
        return {
            "force_exit": True,
            "reason": "å·²è¾¾åˆ°æœ€å¤§å°è¯•æ¬¡æ•°",
            "action": "propose_best_option"
        }
    
    # ç”¨æˆ·æ˜ç¡®é€€å‡º
    if user_input in ["ä¸‹ä¸€æ­¥", "å…ˆè¿™æ ·", "ç»§ç»­"]:
        return {
            "exit": True,
            "action": "finalize_with_current_best"
        }
    
    # æ­£å¸¸ç»§ç»­
    return {"continue": True}
å½“è¾¾åˆ°ä¸Šé™æ—¶ï¼š
ğŸ¤– "æˆ‘ä»¬å·²ç»è®¨è®ºäº†5è½®ï¼Œæˆ‘æœ‰ä¸¤ä¸ªå»ºè®®ï¼š
1. ç”¨å½“å‰æœ€å¥½çš„ç‰ˆæœ¬ï¼š'æ€æ ·ç»™æ¤ç‰©å–æ°´æœ€çœæ°´ï¼Ÿ'
2. æˆ–è€…æˆ‘ä»¬å…ˆè¿›å…¥ä¸‹ä¸€æ­¥è®¾è®¡æƒ…å¢ƒï¼Œä¹‹åæ‚¨å¯ä»¥å†å›æ¥ä¿®æ”¹é—®é¢˜
æ‚¨é€‰å“ªä¸ªï¼Ÿ"
---
9. ä¸å…¶ä»–èŠ‚ç‚¹çš„å¯¹æ¯”
èŠ‚ç‚¹	å¾®å¾ªç¯å…¸å‹åœºæ™¯	ç‰¹æ®Šæ”¯æŒ
scenario	æƒ…å¢ƒä¸å¤Ÿå¸å¼•ã€ä¸å¤ŸçœŸå®	æä¾›çœŸå®æ¡ˆä¾‹åº“å‚è€ƒ
driving_question	é—®é¢˜å¤ªå¼€æ”¾/å¤ªå°é—­ã€ä¸å¤ŸæŒ‘æˆ˜	é—®é¢˜è´¨é‡è¯„ä¼°å™¨
question_chain	é€»è¾‘ä¸è¿è´¯ã€è·³è·ƒå¤ªå¤§	é€»è¾‘é“¾æ¡éªŒè¯
activity	æ“ä½œä¸å¯è¡Œã€ææ–™ä¸è¶³	å®æ—¶å¯è¡Œæ€§æ£€æŸ¥
experiment	å˜é‡æ§åˆ¶ä¸å½“ã€æ—¶é—´ä¸å¤Ÿ	å®éªŒè®¾è®¡æ ¡éªŒ
---
10. æ€»ç»“
è€å¤ªå¤ªçš„æ·±åº¦æ¢ç´¢ä½“éªŒï¼š

ğŸ’¬ "æ¤ç‰©æ˜¯æ€ä¹ˆå–æ°´çš„ï¼Ÿ"
   â†“
ğŸ¤– ç»™æ‚¨3ä¸ªç‰ˆæœ¬ â†’ ğŸ’¬ "è¦æ›´å¼€æ”¾"
   â†“
ğŸ¤– å†ç»™æ‚¨3ä¸ªå¼€æ”¾ç‰ˆ â†’ ğŸ’¬ "åŠ ç¯ä¿"
   â†“
ğŸ¤– 3ä¸ªç¯ä¿å®éªŒç‰ˆ â†’ ğŸ’¬ "è¦æ›´ç®€å•ï¼ŒäºŒå¹´çº§"
   â†“
ğŸ¤– 3ä¸ªç®€åŒ–ç‰ˆ â†’ ğŸ’¬ "ç¬¬1ä¸ªå®Œç¾ï¼"
   â†“
âœ… ç¡®è®¤ï¼è¿›å…¥ä¸‹ä¸€æ­¥...

ç³»ç»Ÿä¿è¯ï¼š
âœ… æ¯æ¬¡ç”Ÿæˆéƒ½åŸºäºç´¯ç§¯çš„çº¦æŸï¼ˆå¼€æ”¾+ç¯ä¿+äºŒå¹´çº§ï¼‰
âœ… ä¸ä¸¢å¤±ä¹‹å‰çš„è®¨è®ºå†å²
âœ… éšæ—¶å¯ä»¥è¯´"å›åˆ°ä¸Šä¸€æ­¥"
âœ… ä¸ä¼šæ— é™å¾ªç¯ï¼Œä¼šæ¸©æŸ”åœ°æ¨è¿›

æ‰€ä»¥ï¼Œæ˜¯çš„â€”â€”ç”¨æˆ·å¯ä»¥åœ¨ä»»æ„èŠ‚ç‚¹ä¸ LLM æ¢è®¨å¾ˆä¹…ï¼Œä¸æ–­æ‰“ç£¨æ–¹æ¡ˆï¼Œç›´åˆ°æ»¡æ„ä¸ºæ­¢ã€‚è¿™æ˜¯ 004 æ¶æ„çš„æ ¸å¿ƒç”¨æˆ·ä½“éªŒï¼ ğŸ”„âœ¨